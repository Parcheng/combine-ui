window.ui = function (e, t, r, i, a, n) { n = new n; var o = new function () { function e() { var e = window.document.location.href, t = window.document.location.pathname, r = e.indexOf(t), i = e.substring(0, r) + t.substring(0, t.substr(1).indexOf("/") + 1); return i } function t(e) { return null == e || null == e || "" == e.toString() } var r = function () { for (var e, t = { types: ["Array", "Boolean", "Date", "Number", "Object", "RegExp", "String", "Window", "HTMLDocument"] }, r = 0; e = t.types[r++];)t[e] = function (e) { return function (t) { return Object.prototype.toString.call(t) == "[object " + e + "]" } }(e); return t }(); function i(e, t) { if (e && t) { for (var r = e, i = t.split("."), a = 0; a < i.length; a++) { if (!r) return; r = r[i[a]] } return r } } return { ajax: function (e) { (e = e || {}).method = e.method.toUpperCase() || "POST", e.url = e.url || "", e.async = e.async || !0, e.data = e.data || null, e.success = e.success || function () { }; var t = null; t = XMLHttpRequest ? new XMLHttpRequest : new ActiveXObject("Microsoft.XMLHTTP"); var r = []; for (var i in e.data) r.push(i + "=" + e.data[i]); var a = r.join("&"); "POST" === e.method.toUpperCase() ? (t.open(e.method, e.url, e.async), t.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=utf-8"), t.send(a)) : "GET" === e.method.toUpperCase() && (t.open(e.method, e.url + "?" + a, e.async), t.send(null)); t.onreadystatechange = function () { 4 == t.readyState && 200 == t.status && e.success(t.responseText) } }, jqAjax: function (e) { console.log("Request url: ", e.url, ", data:", e.data + "."), e.error || (error = function () { console.log("Function jqAjax request " + url + " is error!") }); $.ajax(e) }, getJSON: function (r) { var i; if (t(r)) throw "Load json error: json path is null! "; r = e() + "/" + r, $.ajax({ type: "get", url: r, async: !1, dataType: "json", context: document.body, success: function (e) { i = e }, error: function () { throw "Load json error: json path " + r } }); return i }, ajaxFileUpload: function (e, t, r, i, a) { var n = $("#" + e).val(); n.substring(n.length - 3).toLowerCase(); jQuery.ajaxSettings.traditional = !0, $.ajaxFileUpload({ url: r, secureuri: !1, fileElementId: e, type: "POST", dataType: "multipart/form-data;charset=utf-8", success: i || function () { }, error: a || function () { } }) }, getBasePath: e, is: r, isEmpty: t, dateFromat: function (e, t) { var r = { "M+": e.getMonth() + 1, "d+": e.getDate(), "h+": e.getHours(), "m+": e.getMinutes(), "s+": e.getSeconds(), "q+": Math.floor((e.getMonth() + 3) / 3), S: e.getMilliseconds() }; /(y+)/.test(t) && (t = t.replace(RegExp.$1, (e.getFullYear() + "").substr(4 - RegExp.$1.length))); for (var i in r) new RegExp("(" + i + ")").test(t) && (t = t.replace(RegExp.$1, 1 == RegExp.$1.length ? r[i] : ("00" + r[i]).substr(("" + r[i]).length))); return t }, deepCopy: function e(t, r) { r = r || {}; for (var i in t) "object" == typeof t[i] ? (r[i] = t[i].constructor === Array ? [] : {}, e(t[i], r[i])) : r[i] = t[i]; return r }, callFn: function (e, t, r, i) { if (t) { var a; if ("function" == typeof t) a = i ? t.call(i, r) : t(r); else if ("string" == typeof t) { for (var n = t.split("."), o = 0; o < n.length; o++)e = e[n[o]]; a = i ? e.call(i, r) : e(r) } return a } }, getByPath: i, getQueryString: function (e) { if (e) { var t = new RegExp("(^|&)" + e + "=([^&]*)(&|$)", "i"), r = window.location.search.substr(1).match(t); return null != r ? unescape(r[2]) : null } var i = {}, r = window.location.search.substr(1); if (r) for (var a = r.split("&"), n = 0; n < a.length; n++) { var o = a[n], s = o.split("="); 2 == s.length && (i[s[0]] = s[1]) } return i }, replace: function e(t, a, n, o) { var s = t; if (r.Object(t)) { for (var l in s = {}, t) if (t.hasOwnProperty(l)) { var p = t[l]; s[l] = e(p, a, n, o) } } else if (r.String(t)) { var c = t.match(new RegExp(n, "g")); if (r.Array(c)) for (var d = 0; d < c.length; d++) { var f = c[d], u = f.match(new RegExp(n, "i")); s = s.replace(f, i(a, u[1])) } } else if (r.Array(t)) { for (var m = [], h = 0; h < t.length; h++) { var v = t[h], p = e(v, a, n, o); m.push(p) } s = m } return s }, getUuid: function (e, t) { e && null != e || (e = ""); t && null != t || (t = ""); var r = parseInt(1e5 * Math.random()); return e + r + (new Date).getTime() + t }, addDataToObj: function (e, t, r) { var i = r, a = e.split("."); if (1 == a.length) i[e] = t; else for (var n = 0; n < a.length; n++) { var o = a[n]; n == a.length - 1 ? i[o] = t : i = i[o] = {} } } } }, s = new function (e) { var t = { properties: "{properties}", html: "{html}" }; function r(e, t, r) { return -1 != e.indexOf(r) ? e.replace(r, t) : e } function i(i) { if (!i.name) throw "tag's name is undefined."; var a = function (e) { if ("input" == e || "br" == e || "hr" == e) return 1; return 2 }(i.name), n = function (e, r) { return 1 == r ? "<" + e + " " + t.properties + " />" : "<" + e + " " + t.properties + " >" + t.html + "</" + e + ">" }(i.name, a); return i.properties || (i.properties = {}), i.html || (i.html = ""), i.properties.style && (i.properties.style = function (t) { if (e.is.Object(t)) { var r = ""; for (var i in t) if (t.hasOwnProperty(i)) { var a = t[i]; r += i + ":" + a + ";" } return r } return t }(i.properties.style)), n = r(n, function (e) { var t = ""; for (var r in e) t += r + '="' + e[r] + '" '; return t }(i.properties), t.properties), 2 == a && (n = r(n, i.html, t.html)), n } return { buildTag: i, buildModule: function t(r, a) { a || (a = ""); e.is.Object(r) && (r = [r]); if (e.is.Array(r)) for (var n = 0; n < r.length; n++) { var o = r[n]; if (o) { var s = ""; o.children && o.children.length > 0 ? s = t(o.children) : o.text && (s = o.text), a += i({ name: o.name, properties: o.properties, html: s }) } else console.log("The Child Module is undefined!") } return a }, tags: { brConfig: [{ name: "br" }], hrConfig: [{ name: "hr" }], nbsps: function (e) { e || (e = 6); for (var t = "", r = 0; r < e; r++)t += "&nbsp"; return t } }, modules: { br: function () { return i({ name: "br" }) } } } }(o); return { build: s, parts: e = new e("ui", s, o, n), modules: t = new t("ui", s, o, e, n), page: r = new r(s, o, e, t, n), common: o, config: n, custom: {} } }(function (e, t, r, i) { var a = "P", n = i.part, o = (document.body.scrollWidth, document.body.scrollHeight, { getCurr: function (e, t) { var r = t["part" + e]; if (r) return r }, getConfig: function (e, t) { var r = t["part" + e]; if (r) return r.params }, initCall: function (e, t) { if (e) for (var i = 0; i < t.length; i++) { var a = t[i], n = e.call; n || (n = e.call = {}); var o = n[a]; "function" == typeof o ? n[a] = { fn: o } : r.is.Object(o) ? n[a] = { fn: o.fn, params: o.params } : n[a] = {} } }, initItemCall: function (e, t, i) { if (e) for (var a = 0; a < i.length; a++) { var n = i[a], o = e.call; o || (o = e.call = {}); var s = o[n] ? o[n] : t[n]; "function" == typeof s ? o[n] = { fn: s } : r.is.Object(s) ? o[n] = { fn: s.fn, params: s.params } : o[n] = {} } }, buildBody: function (e, t) { r.is.Array(t) ? e.children = t : r.is.String(t) ? e.text = t : r.is.Object(t) ? e.children = [t] : e.text = "" } }), s = { align: "p-align-", colorGread: "p-color-gread-", none: "p-none" }; return { window: new function () { var i = n.window, s = {}, l = { name: "div", properties: { class: "p-window" }, children: [{ name: "div", properties: { class: "p-header" }, children: [{ name: "div", properties: { class: "p-left" }, text: "" }, { name: "div", properties: { class: "p-right" }, children: [{ name: "span", properties: {}, text: " x " }] }] }, { name: "div", properties: { class: "p-body" }, children: [] }] }, p = { name: "div", properties: { class: "p-window-bg" } }, c = { getConfig: function (e) { return o.getConfig(e, s) }, drag: function (e) { if (n = s["part" + e]) { var t = window.event || arguments.callee.caller.arguments[0], r = t.pageX, a = t.pageY, n = $("#" + i.idPrefix + e), o = parseInt(n.css("top")), l = parseInt(n.css("left")); n.width(), n.height(), n.bind("mousemove", function (e) { var t = e.pageX, i = e.pageY, s = o + (i - a), p = l + (t - r); n.css("top", s), n.css("left", p) }), n.bind("mouseup", function (e) { n.unbind("mousemove mouseup") }) } }, open: function (e) { var t = s["part" + e]; if (t) { var a = t.params, n = a.call.open.fn, o = a.call.open.params; $("#" + i.idPrefix + e).css("display", "block"), $("#" + i.bgIdPrefix).css("display", "block"), r.callFn(window.ui, n, o, t) } else alert(e + " window is nonentity!") }, verify: function (e) { var t = !1, a = s["part" + e]; if (a) { var n = a.params, o = n.call.verify.fn, l = n.call.verify.params; r.callFn(window.ui, o, l, a), t = $("#" + i.idPrefix + e) } return t }, close: function (e) { var t = s["part" + e]; if (t) { var a = t.params, n = a.call.close.fn, o = a.call.close.params; $("#" + i.idPrefix + e).css("display", "none"), $("#" + i.bgIdPrefix).css("display", "none"), r.callFn(window.ui, n, o, t) } else alert(e + " window is nonentity!") }, change: function (e, t, r, a) { var n = s["part" + e]; if (n) { var o = n.params; o.properties || (o.properties = {}), o.other || (o.other = {}); var l = $("#" + i.idPrefix + o.id); if (t) for (var p in t) if (t.hasOwnProperty(p)) { var c = t[p]; l.attr(p, c), o.properties[p] = c } if (a) for (var d in a) if (a.hasOwnProperty(d)) { var f = a[d]; o.other[d] = f } if (r && r.length > 0) { ";" != (r = r.replace(/(\s*$)/g, "")).charAt(r.length - 1) && (r += ";"); var u = l.attr("style"); u = u || "", l.attr("style", r + u) } } else alert(e + " window is nonentity!") }, getConfig(e) { var t = s["part" + e]; if (t) return t.params } }; return { build: function (n) { var c = n.id, d = n.style, f = n.title, u = n.body; r.isEmpty(c) && (n.id = c = r.getUuid(a)), r.isEmpty(f) && (f = " "), o.initCall(n, ["open", "close", "verify"]); var m = r.deepCopy(l); m.properties.id = i.idPrefix + c, d && (m.properties.style = d); var h = m.children[0]; h.properties.onmousedown = e + ".parts.window.drag('" + c + "')", h.children[0].text = f, h.children[1].children[0].properties.onclick = e + ".parts.window.close('" + c + "')"; var v = m.children[1]; if (v.properties.id = i.bodyIdPrefix + c, o.buildBody(v, u), !document.getElementById(i.bgIdPrefix)) { var g = r.deepCopy(p); g.properties.id = i.bgIdPrefix; var y = t.buildModule(g); $(document.body).append(y) } return s["part" + c] = { id: c, params: n, config: m } }, drag: c.drag, open: c.open, verify: c.verify, close: c.close, change: c.change, getConfig: c.getConfig } }, form: new function () { var i = n.form, s = {}, l = { name: "form", properties: { class: "p-forms" }, children: [] }, p = { name: "div", properties: { class: "p-col" }, children: [] }, c = { name: "div", properties: { class: "p-form" }, children: [{ name: "div", properties: { class: "p-title" }, text: "" }, { name: "div", properties: { class: "p-element" }, children: [] }, { name: "div", properties: { class: "p-error-msg", name: i.errorMsgName, style: "display:none" }, text: "" }, { name: "div", properties: { class: "p-help-msg", name: i.helpMsgName, style: "display:none" }, text: "" }] }, d = { input: { name: "input", properties: {}, text: "" }, select: { name: "select", properties: {}, children: [] }, option: { name: "option", properties: {}, text: "" }, textarea: { name: "textarea", properties: {}, text: "" }, span: { name: "span", properties: {}, text: "" }, file: { name: "div", properties: { class: "p-element-file" }, children: [{ name: "input", properties: { type: "text" } }, { name: "input", properties: { type: "file", style: "display:none" } }, { name: "span", properties: {}, text: "" }, { name: "span", properties: {}, text: "" }] } }, f = { getConfig: function (e) { return o.getConfig(e, s) }, submit: function (e, t) { var a = s["part" + e]; if (a) { var n = $("#" + i.idPrefix + e); if (t) for (var o in t) t.hasOwnProperty(o) && n.attr(o, t[o]); n.submit(), r.callFn(window.ui, a.call.submit.fn, a.call.submit.params, curr) } }, setData: function (e, t) { for (var r = s["part" + e].params.elements, i = 0; i < r.length; i++) { var a = r[i]; h(e, a, t[a.key]) } }, getData: function (e) { for (var t = s["part" + e].params.elements, r = {}, i = 0; i < t.length; i++)v(e, t[i], r); return r }, removeData: function (e) { for (var t = s["part" + e].params.elements, r = 0; r < t.length; r++)g(e, t[r]) }, initData: function (e) { for (var t = s["part" + e].params.elements, r = 0; r < t.length; r++)y(e, t[r]) }, verifyData: function (e) { for (var t = this.getData(e), a = { total: !0, data: t, verifys: {} }, n = s["part" + e].params.elements, o = 0; o < n.length; o++) { var l, p = n[o]; if (p.if && (l = x.getIfResult(e, p.key)[p.key]), !r.isEmpty(p.verify) && (null == l || 1 == l)) { var c = m(p.verify, t[p.key]); if (0 == c && (a.total = !1), a.verifys[p.key] = c, p.error) { var d = i.elementNamePrefix + e + "_" + p.key, f = $("*[name='" + d + "']").parent().siblings("*[name='" + i.errorMsgName + "']"); 0 == c ? f.css("display", "block") : f.css("display", "none") } } } return a }, showHelpMsg: function (e, t) { var r = i.helpMsgName, a = $("#" + i.idPrefix + e).find("*[name='" + r + "']"); 1 == t || "show" == t ? a.css("display", "block") : 0 == t || "hide" == t ? a.css("display", "none") : "auto" == t ? a.css("display", "none" == a.css("display") ? "block" : "none") : console.log("Your operation type param is wrong, Plase put in 'show' or 'hide'!") }, command: function (e, t) { s["part" + e].params.elements; var r = x.getIfResult(e, t); for (var a in r) if (r.hasOwnProperty(a)) { var n = r[a], o = i.elementNamePrefix + e + "_" + a; 1 == n ? $("*[name='" + o + "']").parents(".p-form").css("display", "inline-block") : $("*[name='" + o + "']").parents(".p-form").css("display", "none") } } }, u = { setDom: function (e, r, a) { var n = s["part" + e]; if (n && n.elements["element" + r]) { var o = a.title, l = a.help ? a.help : "", p = a.error ? a.error : "", c = $("[id='" + i.elementIdPrefix + e + "_" + r + "']"); c.children(".p-title").html(o), c.children(".p-element").html(t.buildModule(b(e, a))), c.children(".p-error-msg").html(p), c.children(".p-help-msg").html(l), n.elements["element" + r] = a } }, setData: function (e, t, r) { var i = s["part" + e]; if (i) { var a = i.elements["element" + t]; a && r && h(e, a, r) } }, initData: function (e, t) { var r = s["part" + e]; if (r) { var i = r.elements["element" + t]; i && data && y(e, i) } }, getData: function (e, t) { var r = s["part" + e]; if (r) { var i = {}, a = r.elements["element" + t]; return a && i && v(e, a, i), i[t] } }, removeData: function (e, t) { var r = s["part" + e]; if (r) { var i = r.elements["element" + t]; i && g(e, i) } }, file: { checked: function (e, t) { var r = i.elementNamePrefix + e + "_" + t, a = r + i.fileNameSuffix, n = r + i.filePathNameSuffix; $("input[name='" + n + "']").val($("#" + a).val()) }, browse: function (e, t) { var r = i.elementNamePrefix + e + "_" + t + i.fileNameSuffix; $("[id='" + r + "']").trigger("click") }, upload: function (e, t, a, n) { var o = s["part" + e]; if (o) { var l = o.elements["element" + t]; if (l) { n || (n = t); var p = i.elementNamePrefix + e + "_" + t + i.fileNameSuffix, c = $("[id='" + p + "']"); c.attr("id", n), c.attr("name", n), r.ajaxFileUpload(n, void 0, a, function (t) { l.call || (l.call = {}); var i = l.call.upload; l.upload && (i = l.upload), i && (l.formId || (l.formId = e), console.log(l), r.callFn(window.ui, i, t, l)) }, function () { console.log("FormID: " + e + " key: " + t + ": An error occurred while uploading.") }), (c = $("#" + n)).attr("id", p), c.attr("name", p) } } } } }; function m(e, t) { var i = !1, a = e.split("_"); if ("NO_NULL" == e) i = !r.isEmpty(t); else if (2 == a.length) { var n = a[0], o = a[1]; "GTE" == n ? i = parseInt(t) >= parseInt(o) : "GT" == n ? i = parseInt(t) > parseInt(o) : "LTE" == n ? i = parseInt(t) <= parseInt(o) : "LT" == n ? i = parseInt(t) < parseInt(o) : "E" == n && (i = t == o) } else 3 == a.length && "LENGTH" == a[0] && (n = a[1], o = a[2], "GTE" == n ? i = t.length >= parseInt(o) : "GT" == n ? i = t.length > parseInt(o) : "LTE" == n ? i = t.length <= parseInt(o) : "LT" == n ? i = t.length < parseInt(o) : "E" == n && (i = t.length == parseInt(o))); return i } function h(e, t, r) { if (0 != t.isSubmit) { var a = i.elementNamePrefix + e + "_" + t.key; if (r) { if ("text" == t.type || "password" == t.type || "hidden" == t.type) $("input[name='" + a + "']").val(r); else if ("file" == t.type) $("input[name='" + a + i.filePathNameSuffix + "']").val(r); else if ("date" == t.type || "datetime" == t.type || "time" == t.type) { if (isNumber(r)) { var n = "yyyy-MM-dd"; "datetime" == t.type ? n = "yyyy-MM-dd hh:mm:ss" : "time" == t.type && (n = "hh:mm:ss"), r = dateFormat(new Date(r), n) } $("input[name='" + a + "']").val(r) } else "radio" == t.type ? (r += "", $("input:radio[name='" + a + "']:checked").prop("checked", !1), $("input:radio[name='" + a + "']").each(function () { $(this).val() != r || $(this).prop("checked", !0) })) : "checkbox" == t.type ? ($("input:checkbox[name='" + a + "']:checked").prop("checked", !1), $("input:checkbox[name='" + a + "']").each(function () { var e = []; r instanceof Array ? e = r : e.push(r.toString()), e.length > 0 && -1 != e.indexOf(thisValue) && $(this).prop("checked", !0) })) : "select" == t.type ? ($("select[name='" + a + "'] option:first").prop("selected", "selected"), $("select[name='" + a + "'] option").each(function () { if ($(this).val() == r) return console.log($(this).val(), r), void $(this).prop("selected", "selected") }), $("select[name='" + a + "']").trigger("change", [])) : "textarea" == t.type ? $("textarea[name='" + a + "']").val(r) : $("span[name='" + a + "']").text(r); t.commandOf && f.command(e, t.commandOf) } } } function v(e, t, a) { var n = r.addDataToObj; if (0 != t.isSubmit) { var o = "", s = i.elementNamePrefix + e + "_" + t.key; if ("text" == t.type || "date" == t.type || "password" == t.type || "datetime" == t.type || "time" == t.type || "hidden" == t.type) n(t.key, $("input[name='" + s + "']").val(), a); else if ("file" == t.type) n(t.key, $("input[name='" + s + i.filePathNameSuffix + "']").val(), a); else if ("radio" == t.type) n(t.key, $("input:radio[name='" + s + "']:checked").val(), a); else if ("checkbox" == t.type) o = [], $("input:checkbox[name='" + s + "']:checked").each(function () { o.push($(this).val()) }), n(t.key, o, a); else if ("select" == t.type) { var l = t.key.split(","); 1 == l.length ? n(l[0], $("select[name='" + s + "'] option:selected").val(), a) : 2 == l.length && (n(l[0], $("select[name='" + s + "'] option:selected").val(), a), n(l[1], $("select[name='" + s + "'] option:selected").text(), a)) } else "textarea" == t.type ? n(t.key, $("textarea[name='" + s + "']").val(), a) : n(t.key, $("*[name='" + s + "']").text(), a) } } function g(e, t) { if (0 != t.isSubmit) { var r = i.elementNamePrefix + e + "_" + t.key; "text" == t.type || "date" == t.type || "password" == t.type || "datetime" == t.type || "time" == t.type ? $("input[name='" + r + "']").val("") : "file" == t.type ? ($("input[name='" + r + i.filePathNameSuffix + "']").val(""), $("input[name='" + r + i.fileNameSuffix + "']").val("")) : "radio" == t.type ? $("input:radio[name='" + r + "']:checked").prop("checked", !1) : "checkbox" == t.type ? $("input:checkbox[name='" + r + "']:checked").each(function () { $(this).prop("checked", !1) }) : "select" == t.type ? $("select[name='" + r + "'] option:first").prop("selected", "selected") : "textarea" == t.type ? $("textarea[name='" + r + "']").val("") : $("*[name='" + r + "']").text(""), t.commandOf && f.command(e, t.commandOf) } } function y(e, t) { var r = t.value; r ? h(e, t, r) : g(e, t) } var x = { data: {}, init: function (e, t) { for (var r = this.data["ifCommand" + e] = {}, i = r.commands = {}, a = r.ifs = {}, n = [], o = 0; o < t.length; o++)if ((c = t[o]).if) { var s = c.if = this.ifAnaly(c.if); if (s.left && "@" == s.left.charAt(0)) { var l = s.left.replace("@", ""); n[l] || (n[l] = []), n[l].push(c.key) } if (s.right && "@" == s.right.charAt(0)) { var p = s.right.replace("@", ""); n[p] || (n[p] = []), n[p].push(c.key) } a[c.key] = c } for (o = 0; o < t.length; o++) { var c; n[(c = t[o]).key] && (c.commandOf = n[c.key], i[c.key] = c) } }, getIfResult: function (e, t) { var i = this.data["ifCommand" + e], a = {}; if (i) { var n = i.ifs, o = i.commands; r.is.Array(t) || (t = t.split(",")); for (var s = 0; s < t.length; s++) { var l = t[s], p = n[l], c = p.if.left, d = p.if.condition, f = p.if.right; if ("@" == c.charAt(0)) { var u = c.replace("@", ""); v(e, o[u], m = {}), c = m[u] } if ("@" == f.charAt(0)) { var m, h = f.replace("@", ""); v(e, o[h], m = {}), f = m[h] } var g = new Function("return ('" + c + "'" + d + "'" + f + "');"); a[l] = g() } } return a }, ifAnaly: function (e) { for (var t, r, i, a, n = ["==", "!=", ">=", "<=", ">", "<", ":"], o = 0; o < n.length; o++) { var s = n[o]; if (-1 != e.indexOf(s)) { r = s, t = e.split(s); break } } return t && t.length > 0 && (i = t[0], t.length > 1 && (a = t[1])), { left: i, right: a, condition: r } } }; function b(a, n) { var o = i.elementNamePrefix + a + "_" + n.key, s = n.type, l = n.value ? n.value : "", p = n.default ? n.default : "", c = n.children, f = n.commandOf, u = []; if ("text" == s || "password" == s || "hidden" == s) (k = r.deepCopy(d.input)).properties.name = o, k.properties.type = s, k.properties.value = l, k.properties.placeholder = p, f && (k.properties.onblur = e + ".parts.form.command('" + a + "','" + f + "')"), u.push(k); else if ("file" == s) { var m = n.url, h = n.fileName; (k = r.deepCopy(d.file)).properties.name = o, k.children[0].properties.name = o + i.filePathNameSuffix, k.children[0].properties.value = l, k.children[0].properties.placeholder = p, f && (k.children[0].properties.onblur = e + ".parts.from.command('" + a + "','" + f + "')"), k.children[1].properties.id = o + i.fileNameSuffix, k.children[1].properties.name = o + i.fileNameSuffix, k.children[1].properties.onchange = e + ".parts.form.element.file.checked('" + a + "','" + n.key + "')", k.children[2].properties.onclick = e + ".parts.form.element.file.browse('" + a + "','" + n.key + "')", k.children[2].text = i.fileBrowseButtonName, k.children[3].properties.onclick = e + ".parts.form.element.file.upload('" + a + "','" + n.key + "','" + m + "','" + h + "')", k.children[3].text = i.fileUploadButtonName, u.push(k) } else if ("select" == s) { (k = r.deepCopy(d.select)).properties.name = o, f && (k.properties.onchange = e + ".parts.form.command('" + a + "','" + f + "')"); var v = r.deepCopy(d.option); v.properties.value = p.value, v.text = p.text, k.children.push(v); for (var g = 0; g < c.length; g++) { var y = c[g], x = r.deepCopy(d.option); x.properties.value = y.value, y.value == l && (x.properties.selected = "selected"), x.text = y.text, k.children.push(x) } u.push(k) } else if ("date" == s || "datetime" == s || "time" == s) (k = r.deepCopy(d.input)).properties.name = o, k.properties.type = s, k.properties.value = l, f && (k.properties.onblur = e + ".parts.form.command('" + a + "','" + f + "')"), u.push(k); else if ("radio" == s || "checkbox" == s) for (g = 0; g < c.length; g++) { y = c[g], (k = r.deepCopy(d.input)).properties.name = o, k.properties.type = s, f && (k.properties.onclick = e + ".parts.form.command('" + a + "','" + f + "')"), ("radio" == s && y.value == l || "checkbox" == s && l.indexOf(y.value)) && (k.properties.checked = "checked"), y = c[g], k.properties.value = y.value; var b = { name: "label", text: t.tags.nbsps(2) + y.text + t.tags.nbsps(3) }; u.push(k), u.push(b) } else if ("textarea" == s) (k = r.deepCopy(d.textarea)).properties.name = o, k.text = l, f && (k.properties.onblur = e + ".parts.form.command('" + a + "','" + f + "')"), u.push(k); else { var k; (k = r.deepCopy(d.span)).properties.name = o, k.text = l, f && (k.properties.onblur = e + ".parts.form.command('" + a + "','" + f + "')"), u.push(k) } return u } return { build: function (e) { var t = e.id, n = e.style, o = e.col ? parseInt(e.col) : 1, d = e.elements; e.call || (e.call = {}), r.isEmpty(t) && (e.id = t = r.getUuid(a)), x.init(t, d); for (var f = {}, u = new Array(o), m = 0, h = 0; h < d.length; h++) { var v = d[h], g = v.title, y = v.help ? v.help : "", k = v.error ? v.error : "", w = 0 != v.show, P = u[m]; if (!P) { var C = r.deepCopy(p); C.properties.style = "width:" + parseInt(100 / o) + "%;", P = u[m] = C } var I = P.children; m == o - 1 ? m = 0 : m++; var $ = r.deepCopy(c); $.properties.id = i.elementIdPrefix + t + "_" + v.key, w && !v.if || ($.properties.style = "display:none;"), $.children[0].text = g, $.children[1].children = b(t, v), $.children[2].text = k, $.children[3].text = y, f["element" + v.key] = v, I.push($) } var _ = r.deepCopy(l); return _.properties.id = i.idPrefix + t, n && (_.properties.style = n), _.children = u, s["part" + t] = { id: t, params: e, config: _, elements: f } }, getConfig: f.getConfig, submit: f.submit, setData: f.setData, getData: f.getData, removeData: f.removeData, verifyData: f.verifyData, initData: f.initData, showHelp: f.showHelpMsg, command: f.command, element: { setDom: u.setDom, setData: u.setData, initData: u.initData, getData: u.getData, removeData: u.removeData, file: { checked: u.file.checked, browse: u.file.browse, upload: u.file.upload } } } }, buttons: new function () { var t = n.buttons, i = {}, s = { name: "div", properties: { class: "p-buttons" }, children: [] }, l = { name: "div", properties: { class: "p-button" }, text: "" }, p = { getConfig: function (e) { return o.getConfig(e, i) }, click: function (e, t) { for (var a = i["part" + e].params.buttons, n = 0; n < a.length; n++) { var o = a[n]; if (o.id == t) return void r.callFn(window.ui, o.call.click.fn, o.call.click.params, o) } } }; return { build: function (n) { var p = n.id, c = n.align, d = n.style, f = n.buttons; r.isEmpty(p) && (n.id = p = r.getUuid(a)); var u = r.deepCopy(s); u.properties.id = t.idPrefix + p, c && "left" == c ? u.properties.class += " p-left" : c && "right" == c && (u.properties.class += " p-right"), d && (u.properties.style = d); for (var m = 0; m < f.length; m++) { var h = f[m], v = r.deepCopy(l), g = h.id, y = 0 != h.click, x = h.text; r.isEmpty(g) && (h.id = g = r.getUuid(a)), o.initCall(h, ["click", "dblclick"]), h.call || (h.call = {}), h.call.click && 0 != y && (v.properties.onclick = e + ".parts.buttons.click('" + p + "','" + g + "')"), v.properties.id = t.idPrefix + p + "_" + g, v.text = x, u.children.push(v) } return n.id = p, i["part" + p] = { id: p, params: n, config: u } }, getConfig: p.getConfig, click: p.click } }, grid: new function () { var t = n.grid, i = {}, s = { name: "table", properties: { class: "p-grid" }, children: [] }, l = { getConfig: function (e) { return o.getConfig(e, i) }, click: function (e, t) { var a = i["part" + e]; if (a) { var n = a.params.elements; r.callFn(window.ui, n[t].call.click.fn, n[t].call.click.params, n[t]) } else alert("The call back function is nonentity!") }, dblclick: function (e, t) { var a = i["part" + e]; if (a) { var n = a.params.elements; r.callFn(window.ui, n[t].call.dblclick.fn, n[t].call.dblclick.params, n[t]) } else alert("The call back function is nonentity!") } }; return { build: function (n) { var l = n.id, p = parseInt(n.col), c = n.elements; r.isEmpty(l) && (n.id = l = r.getUuid(a)), o.initCall(n, ["click", "dblclick"]); for (var d = r.deepCopy(s), f = 0, u = 0, m = [0, 0], h = { name: "tr", properties: { class: "first" }, children: [] }, v = 0; v < c.length; v++) { var g = c[v], y = t.idPrefix + l + "_" + g.key, x = g.text, b = g.style ? g.style : "", k = parseInt(g.width ? g.width : 1), w = parseInt(g.height ? g.height : 1), P = { name: "td", properties: {}, text: "" }; if (P.properties.id = y, P.text = x, o.initItemCall(g, n.call, ["click", "dblclick"]), g.call.click.fn && 0 != g.click && (P.properties.onclick = e + ".parts.grid.click('" + l + "','" + v + "')"), g.call.dblclick.fn && 0 != g.dblclick && (P.properties.ondblclick = e + ".parts.grid.dblclick('" + l + "','" + v + "')"), h.properties && (P.properties.style = "width:" + 100 / p * k + "%" + b), k > 1 && (P.properties.colspan = k), w > 1) { P.properties.rowspan = w; for (var C = 1; C <= w - 1; C++)m[u + C] || (m[u + C] = 0), m[u + C] = m[u + C] + k } f += k, h.children.push(P), m[u] || (m[u] = 0), (p - m[u] <= f || v == c.length - 1) && (d.children.push(h), f = 0, u += 1, h = { name: "tr", children: [] }) } return i["part" + l] = { id: l, params: n, config: d } }, click: l.click, dblclick: l.dblclick } }, drawBoard: new function () { var i = [], s = n.drawBoard, l = {}, p = { name: "div", properties: { class: "p-draw-board" }, children: [{ name: "div", properties: { class: "p-toolbar" }, children: [{ name: "div", properties: { class: "p-head" }, text: "" }, { name: "div", properties: { class: "p-tool" }, children: [] }] }, { name: "div", properties: { class: "p-panel" }, children: [] }] }, c = { name: "div", properties: { class: "p-draw-exterior" }, children: [] }, d = { name: "div", properties: { class: "p-draw-shape" }, children: [] }, f = { marker: { name: "div", properties: { name: "connect_svg", class: "p-draw-connect" }, children: [{ name: "svg", properties: { width: "100%", height: "100%", version: "1.1", xmlns: "http://www.w3.org/2000/svg" }, children: [{ name: "defs", children: [{ name: "marker", properties: { id: "dragArrow", markerWidth: "13", markerHeight: "13", refx: "4", refy: "4", orient: "auto" }, children: [{ name: "circle", properties: { cx: "4", cy: "4", r: "2", fill: "gray" }, text: "" }] }, { name: "marker", properties: { id: "endArrow", markerWidth: "13", markerHeight: "13", refx: "4", refy: "4", orient: "auto" }, children: [{ name: "circle", properties: { cx: "4", cy: "4", r: "2", fill: "#990033" }, text: "" }] }, { name: "marker", properties: { id: "checkedArrow", markerWidth: "13", markerHeight: "13", refx: "4", refy: "4", orient: "auto" }, children: [{ name: "circle", properties: { cx: "4", cy: "4", r: "2", fill: "gray" }, text: "" }] }] }] }] }, point: { name: "div", properties: { class: "" }, children: [{ name: "svg", properties: { width: "100%", height: "100%", version: "1.1", xmlns: "http://www.w3.org/2000/svg" }, children: [{ name: "circle", properties: { cx: "5", cy: "50%", r: "7", fill: "#990033" }, text: "" }, { name: "text", properties: { x: "50%", y: "50%", dy: ".3em", fill: "white", "text-anchor": "middle", "font-size": "10px" }, text: "" }] }] }, line: { name: "line", properties: { x1: "0", y1: "0", x2: "100", y2: "100", stroke: "gray", "stroke-width": "4", "marker-end": "", tabindex: "0" }, text: "" } }, u = { name: "div", properties: { class: "p-draw-region" }, text: "" }, m = { click: function (e) { v.uncheckAll(e), g.uncheckAll(e) }, region: function (e) { var i = l["part" + e]; if (i) { this.click(e); var a = window.event || arguments.callee.caller.arguments[0], n = a.pageX, o = a.pageY, p = $("#" + s.drawIdPrefix + e), c = r.deepCopy(u); c.properties.style = "left:" + n + "px;top:" + o + "px;width:0px;height:0px;", p.append(t.buildModule(c)); var d = p.children(".p-draw-region"); p.bind("mousemove", function (e) { var t = parseInt(e.pageX), r = parseInt(e.pageY), i = Math.abs(t - n), a = Math.abs(r - o); d.css("width", i), t < n && d.css("left", t), d.css("height", a), r < o && d.css("top", r) }), p.bind("mouseup", function (t) { parseInt(t.pageX), parseInt(t.pageY), d.remove(); var r = parseInt(d.css("left")), a = parseInt(d.css("top")), n = r + parseInt(d.css("width")), o = a + parseInt(d.css("height")), s = i.shape; for (var l in s) if (s.hasOwnProperty(l)) { var c = s[l], f = c.position, u = f.left, m = f.right, h = f.top, g = f.bottom; m > r && u < n && g > a && h < o && v.checked(e, c.id) } p.unbind("mousemove mouseup") }) } }, zoom: function (e, t, r) { if (l["part" + e]) { var i = $("#" + s.drawIdPrefix + e).parent(), a = parseInt(i.css("width")), n = parseInt(i.css("height")), o = parseInt(i.css("max-width")), p = parseInt(i.css("max-height")), c = parseInt(i.css("min-width")), d = parseInt(i.css("min-height")), f = a + (t = -1 != t.indexOf("%") ? a * parseInt(t) / 100 : parseInt(t)), u = n + (r = -1 != r.indexOf("%") ? n * parseInt(r) / 100 : parseInt(r)); f < c && (f = c), f > o && (f = o), u < d && (u = d), u > p && (u = p), i.css("width", f), i.css("height", u) } }, getCurr: function (e) { return o.getCurr(e, l) }, getConfig: function (e) { return o.getConfig(e, l) } }, h = { click: function (e, t, i) { var a = l["part" + e]; if (a) for (var n = a.params.tool.bars[t].elements, o = 0; o < n.length; o++) { var s = n[o]; if (s.key == i) { r.callFn(window.ui, s.call.click.fn, s.call.click.params, a); break } } }, drag: function (e, i, a) { var n = l["part" + e]; if (n) for (var o = n.params.tool.bars[i].elements, p = 0; p < o.length; p++) { var c = o[p]; if (c.key == a) { var d = window.event || arguments.callee.caller.arguments[0], f = d.pageX, u = d.pageY, m = $("#" + s.drawIdPrefix + e), h = m.width(), v = m.height(); parseInt(m.css("marginTop")), parseInt(m.css("marginLeft")), f -= m.offset().left, u -= m.offset().top; var g = $("#" + s.toolIdPrefix + e + "_" + c.key), y = g.width(), x = g.height(), b = (parseInt(g.css("marginTop")), g.html(), { name: "div", properties: { id: "temp_tool_drag" }, text: "" }); b.properties.style = "margin-top:" + (u - x / 2) + "px; margin-left:" + (f - y / 2) + "px;position: absolute; z-index:9999; width:" + y + "px; height:" + x + "px;background-color:black;opacity:.5;", m.append(t.buildModule(b)); var k = $("#temp_tool_drag"); m.bind("mousemove", function (e) { var t = e.pageX, r = e.pageY; t -= m.offset().left; var i = (r -= m.offset().top) - x / 2, a = t - y / 2; i < 0 && (i = 0), i > v - x && (i = v - x), a < 0 && (a = 0), a > h - y && (a = h - y), k.css("marginTop", i), k.css("marginLeft", a) }), m.bind("mouseup", function (e) { for (var t in c.call.drag.params || (c.call.drag.params = {}), c) c.hasOwnProperty(t) && "call" != t && (c.call.drag.params[t] = c[t]); c.call.drag.params.top = k.css("marginTop"), c.call.drag.params.left = k.css("marginLeft"), k.remove(), m.unbind("mousemove mouseup"), r.callFn(window.ui, c.call.drag.fn, c.call.drag.params, n) }); break } } } }, v = { create: function (i, n) { var p = l["part" + i]; if (p) { var u, m, h = p.params.shape, v = h.currNum, g = parseInt(h.maxNum), y = h.keyMaxNum, x = h.keyCurrNum, b = n.type; if (r.isEmpty(b) || (y && (m = parseInt(y[b])), (u = x[b]) || (u = x[b] = 0)), (!g || v < g) && (!m || u < m)) { var k = n.id, w = n.title ? n.title : "", P = n.base, C = n.body, I = n.style ? n.style : "", _ = null != n.leftPoint ? n.leftPoint : s.connectPointText, D = null != n.rightPoint ? n.rightPoint : s.connectPointText, N = 0 != n.checked, E = 0 != n.dblclick, M = 0 != n.drag, F = 0 != n.connect, O = 0 != n.del; n.zoom, r.isEmpty(k) && (n.id = k = r.getUuid(a)), o.initCall(n, ["dblclick", "drag", "change", "delete"]); var T = P.top ? P.top : "0px", A = P.left ? P.left : "0px", S = P.width ? P.width : "50px", j = P.height ? P.height : "50px", z = P.border ? P.border : "0px", B = P.zIndex ? P.zIndex : "1", U = r.deepCopy(c); if (U.properties.id = s.shapeIdPrefix + k, U.properties.tabindex = "0", U.properties.style = "margin-top:" + T + ";margin-left:" + A + ";z-index:" + B + ";border:" + z + ";width:" + S + ";height:" + j + ";;line-height:" + j + ";" + I, 1 == O && (U.properties.onkeydown = e + ".parts.drawBoard.shape.delete('" + i + "','" + k + "')"), U.properties.title = w, 1 == F) { if (!1 !== _) { var L = r.deepCopy(f.point); L.properties.class = "p-point-left", L.children[0].children[1].text = _, U.children.push(L) } if (!1 !== D) { var R = r.deepCopy(f.point); R.properties.class = "p-point-right", R.children[0].children[1].text = D, R.properties.onmousedown = e + ".parts.drawBoard.connect.create('" + i + "','" + k + "')", U.children.push(R) } } var X = r.deepCopy(d); 1 == E && (X.properties.ondblclick = e + ".parts.drawBoard.shape.dblclick('" + i + "','" + k + "')"), 1 == M && (X.properties.onmousedown = e + ".parts.drawBoard.shape.drag('" + i + "','" + k + "')"), 1 == N && (X.properties.onclick = e + ".parts.drawBoard.shape.checked('" + i + "','" + k + "')"), r.is.Array(C) ? X.children = C : r.is.Object(C) ? X.children.push(C) : r.is.String(C) && (X.text = C), U.children.push(X), p.shape["shape" + k] = { id: k, params: n, config: U, position: { id: k, in: 1 == F && !1 !== _, out: 1 == F && !1 !== D, top: parseInt(T), left: parseInt(A), right: parseInt(A) + parseInt(S), bottom: parseInt(T) + parseInt(j), zIndex: parseInt(B) } }, h.currNum += 1, b && (x[b] += 1), $("#" + s.drawIdPrefix + i).append(t.buildModule(U)) } } }, dblclick: function (e, t) { var i = l["part" + e]; if (i) { var a = i.shape["shape" + t], n = a.params; r.callFn(window.ui, n.call.dblclick.fn, n.call.dblclick.params, a) } }, getConfig: function (e, t) { var r = l["part" + e]; if (r) { var i = r.shape["shape" + t]; if (i) return i.params } }, change: function (e, t, r, i) { }, drag: function (e, t) { var r = l["part" + e]; if (r) { var i = r.shape["shape" + t], a = window.event || arguments.callee.caller.arguments[0], n = a.pageX, o = a.pageY, p = $("#" + s.shapeIdPrefix + t), c = p.width(), d = p.height(), f = parseInt(p.css("marginTop")), u = parseInt(p.css("marginLeft")), m = p.parent(), h = m.width(), v = m.height(); a.stopPropagation(); var y = void 0, x = void 0; m.bind("mousemove", function (r) { var i = r.pageX, a = r.pageY, s = f + (a - o), l = u + (i - n); s < 0 && (s = 0), s > v - d && (s = v - d), l < 0 && (l = 0), l > h - c && (l = h - c), y = s, x = l, p.css("marginTop", s), p.css("marginLeft", l), g.moveShape(e, t, s, l, c, d) }), m.bind("mouseup", function (e) { if (y && x) { var t = i.position; t.top = y, t.left = x, t.right = x + c, t.bottom = y + d } m.unbind("mousemove mouseup") }) } }, checked: function (e, t) { var r = window.event || arguments.callee.caller.arguments[0], i = $("#" + s.shapeIdPrefix + t); "1" == i.attr("status") ? (i.removeClass("p-draw-shape-focus"), i.attr("status", "0")) : (i.addClass("p-draw-shape-focus"), i.attr("status", "1")), r.stopPropagation() }, uncheckAll: function (e) { var t = $("#" + s.drawIdPrefix + e).children(".p-draw-exterior"); t.attr("status", "0"), t.removeClass("p-draw-shape-focus") }, delete: function (e, t) { var i = l["part" + e]; if (i) { var a = i.shape["shape" + t], n = a.params; 8 == (window.event || arguments.callee.caller.arguments[0]).keyCode && confirm("确认删除吗？") && (t && ($("#" + s.shapeIdPrefix + t).remove(), g.removeShape(e, t), delete i.shape["shape" + t], i.params.shape.keyCurrNum[n.type] -= 1, i.params.shape.currNum -= 1), r.callFn(window.ui, n.call.delete.fn, n.call.delete.params, a)) } }, deleteAll: function (e) { var t = l["part" + e]; if (t && t.shape) { var r = t.shape; for (var i in r) if (r.hasOwnProperty(i)) { var a = r[i], n = $("#" + s.shapeIdPrefix + a.id); "1" == n.attr("status") && (n.remove(), g.removeShape(e, a.id), delete r["shape" + a.id]) } } } }, g = { create: function (n, o) { var p = l["part" + n]; if (p) { var c = window.event || arguments.callee.caller.arguments[0]; c.stopPropagation(), c.pageX, c.pageY; var d = n, u = r.deepCopy(f.line), m = $("#" + s.shapeIdPrefix + o), h = parseInt(m.width()), v = parseInt(m.height()), y = parseInt(m.css("marginTop")), x = parseInt(m.css("marginLeft")), b = m.parent(); b.width(), b.height(), b.offset().left, b.offset().top; var k = r.getUuid(a), w = parseInt(u.properties["stroke-width"]) / 2; if (u.properties.id = s.connectLineIdPrefix + k, u.properties.x1 = x + h + s.stratGap, u.properties.y1 = y + v / 2 + w, u.properties.x2 = x + h + s.stratGap, u.properties.y2 = y + v / 2 + w, u.properties.onmousedown = e + ".parts.drawBoard.connect.checked('" + n + "','" + k + "', true)", u.properties.onkeydown = e + ".parts.drawBoard.connect.delete('" + n + "','" + k + "')", 0 == i.length || -1 == i.indexOf(d)) { i.push(d); var P = r.deepCopy(f.marker); P.properties.id = s.connectIdPrefix + d, b.append(t.buildModule(P)) } var C = b.children("*[name='connect_svg']").children("svg"); C.html(C.html() + t.buildModule(u)), b.bind("mousemove", function (e) { var t = parseInt(e.pageX), r = parseInt(e.pageY); t -= b.offset().left, r -= b.offset().top, parseInt(b.css("marginTop")), parseInt(b.css("marginLeft")); var i = $("#" + s.connectLineIdPrefix + k); i.attr("x2", t), i.attr("y2", r) }), b.bind("mouseup", function (e) { var t = parseInt(e.pageX), r = parseInt(e.pageY); t -= b.offset().left, r -= b.offset().top; var i = void 0, a = void 0, c = p.shape; for (var d in c) if (c.hasOwnProperty(d)) { var f = c[d].position; if (1 == f.in) { var u = t - f.left, m = f.right - t, h = r - f.top, v = f.bottom - r, y = 0 - s.allowNum; if (u > y && m > y && h > y && v > y) { var x = Math.min(Math.abs(u), Math.abs(m), Math.abs(h), Math.abs(v)); (null == i || null == a || i > x) && (i = x, a = f) } } } var P = !1; if (p.params.connect.verify ? null != i && null != a && (P = g.verify(n, o, a.id)) : P = !0, 1 != P || o == a.id) $("#" + s.connectLineIdPrefix + k).remove(); else { var C = $("#" + s.connectLineIdPrefix + k); C.attr("x2", a.left - s.endGap), C.attr("y2", a.top + (a.bottom - a.top) / 2 + w), C.attr("stroke", "#990033"), l["part" + n].connects["connect" + k] = { id: k, shapes: [{ shapeId: o, type: "start" }, { shapeId: a.id, type: "end" }] } } b.unbind("mousemove mouseup") }) } }, add: function (a, n, o, p) { var c = l["part" + a]; if (c) { var d = c.shape["shape" + n], u = c.shape["shape" + o], m = l["part" + a].connects; if (d && u && (p || (p = s.connectLineIdPrefix + connectIndex, connectIndex++), !m["connect" + p])) { var h = a, v = r.deepCopy(f.line), g = $("#" + s.shapeIdPrefix + n), y = parseInt(g.width()), x = parseInt(g.height()), b = parseInt(g.css("marginTop")), k = parseInt(g.css("marginLeft")), w = $("#" + s.shapeIdPrefix + o), P = (parseInt(w.width()), parseInt(w.height())), C = parseInt(w.css("marginTop")), I = parseInt(w.css("marginLeft")), _ = g.parent(), D = parseInt(v.properties["stroke-width"]) / 2; if (v.properties.id = s.connectLineIdPrefix + p, v.properties.x1 = k + y + s.stratGap, v.properties.y1 = b + x / 2 + D, v.properties.x2 = I - s.endGap, v.properties.y2 = C + P / 2 + D, v.properties.stroke = "#990033", v.properties.onmousedown = e + ".parts.drawBoard.connect.checked('" + a + "','" + p + "', true)", v.properties.onkeydown = e + ".parts.drawBoard.connect.delete('" + a + "','" + p + "')", 0 == i.length || -1 == i.indexOf(h)) { i.push(h); var N = r.deepCopy(f.marker); N.properties.id = s.connectIdPrefix + h, _.append(t.buildModule(N)) } var E = _.children("*[name='connect_svg']").children("svg"); E.html(E.html() + t.buildModule(v)), m["connect" + p] = { id: p, shapes: [{ shapeId: n, type: "start" }, { shapeId: o, type: "end" }] } } } }, moveShape: function (e, t, r, i, a, n) { var o = l["part" + e]; if (o) { var p = o.connects; for (var c in p) if (p.hasOwnProperty(c)) { var d = p[c], f = $("#" + s.connectLineIdPrefix + d.id), u = parseInt(f.attr("stroke-width")) / 2; d.shapes[0].shapeId == t && (f.attr("x1", parseInt(i) + parseInt(a) + s.stratGap), f.attr("y1", parseInt(r) + parseInt(a) / 2 + u)), d.shapes[1].shapeId == t && (f.attr("x2", parseInt(i) - s.endGap), f.attr("y2", parseInt(r) + parseInt(a) / 2 + u)) } } }, checked: function (e, t) { var r = window.event || arguments.callee.caller.arguments[0], i = $("#" + s.connectLineIdPrefix + t); "1" == i.attr("status") ? (i.attr("stroke", "#990033"), i.attr("status", "0")) : (i.attr("stroke", "gray"), i.attr("status", "1")), r.stopPropagation() }, uncheckAll: function (e) { $("#" + s.connectIdPrefix + e + " svg").children().each(function () { 1 == $(this).attr("status") && ($(this).attr("stroke", "#990033"), $(this).attr("status", "0")) }) }, delete: function (e, t, r) { var i = window.event || arguments.callee.caller.arguments[0], a = l["part" + e]; if (a && (1 != r || 8 == i.keyCode)) { if ($("#" + s.connectLineIdPrefix + t).remove(), a.params.connect.verify) { var n = a.connects["connect" + t]; if (n) { for (var o, p, c = n.shapes, d = 0; d < c.length; d++) { var f = c[d]; "start" == f.type ? o = f : p = f } var u = a.shape["shape" + o.shapeId], m = a.shape["shape" + p.shapeId]; u && u.params.connect && (u.params.connect.currOut -= 1, null != u.params.connect.currTo[m.params.type] && (u.params.connect.currTo[m.params.type] -= 1)), m && m.params.connect && (m.params.connect.currIn -= 1, null != m.params.connect.currFrom[u.type] && (m.params.connect.currFrom[u.type] -= 1)) } } delete a.connects["connect" + t] } }, deleteAll: function (e) { var t = l["part" + e]; if (t) { var r = t.connects; for (var i in r) if (r.hasOwnProperty(i)) { var a = r[i]; "1" == $("#" + s.connectLineIdPrefix + a.id).attr("status") && this.delete(e, a.id) } } }, removeShape: function (e, t) { var r = l["part" + e]; if (r) { var i = r.connects; for (var a in i) if (i.hasOwnProperty(a)) { var n = i[a]; n.shapes[0].shapeId != t && n.shapes[1].shapeId != t || this.delete(e, n.id) } } }, verify: function (e, t, i) { var a = l["part" + e]; if (a) { var n = a.shape, o = a.params.connect.verify, s = n["shape" + t].params, p = n["shape" + i].params; if (s && p) { if (o) { if (o[s.type]) { s.connect || (s.connect = {}), s.connect.currOut || (s.connect.currOut = 0), s.connect.currTo || (s.connect.currTo = {}); var c = o[s.type]; if (c.maxOut && s.connect.currOut >= c.maxOut) return !1; if (c.to) if (r.is.String(c.to)) { if (c.to != p.type) return !1 } else if (r.is.Array(c.to)) { if (-1 == c.to.indexOf(p.type)) return !1 } else if (r.is.Object(c.to)) { if (!c.to[p.type]) return !1; var d = s.connect.currTo, f = d[p.type]; if (f || (f = d[p.type] = 0), parseInt(c.to[p.type]) <= f) return !1 } } if (o[p.type]) { p.connect || (p.connect = {}), p.connect.currIn || (p.connect.currIn = 0), p.connect.currFrom || (p.connect.currFrom = {}); var u = o[p.type]; if (u.maxIn && p.connect.currIn >= u.maxIn) return !1; if (u.from) if (r.is.String(u.from)) { if (u.from != s.type) return !1 } else if (r.is.Array(u.from)) { if (-1 == u.from.indexOf(s.type)) return !1 } else if (r.is.Object(u.from)) { if (!u.from[s.type]) return !1; var m = p.connect.currFrom, h = m[s.type]; if (h || (h = m[s.type] = 0), parseInt(u.from[s.type]) <= h) return !1 } } p.connect && (p.connect.currIn += 1, null != p.connect.currFrom[s.type] && (p.connect.currFrom[s.type] += 1)), s.connect && (s.connect.currOut += 1, null != s.connect.currTo[p.type] && (s.connect.currTo[p.type] += 1)) } return !0 } } return !1 } }; return { build: function (i) { var n = i.id, c = i.style, d = i.tool, f = 1 == i.region; r.isEmpty(n) && (i.id = n = r.getUuid(a)); var u = i.connect; u || (u = i.connect = {}), u.call || (u.call = {}), u.call.create || (u.call.create = {}), u.call.checked || (u.call.delete = {}), u.call.delete || (u.call.delete = {}), i.shape || (i.shape = {}), i.shape.currNum = 0, i.shape.keyCurrNum = {}; var m = d.title ? d.title : "", h = d.style ? d.style : "", v = d.bars, g = r.deepCopy(p), y = g.children[0].children[1].children; g.children[0].children[0].text = m, r.isEmpty(c) || (g.properties.style = c), r.isEmpty(h) || (g.children[0].properties.style = h), o.initCall(d, ["click", "drag"]); for (var x = 0; x < v.length; x++) { var b, k = v[x], w = parseInt(k.col ? k.col : 2), P = k.style, C = k.elements; o.initItemCall(k, d.call, ["click", "drag"]), b = 1 == w ? "width:80%;margin: 8px 10%;" : 2 == w ? "width:40%;margin:8px 5%;" : 3 == w ? "width:27%;margin:8px 3%;" : w > 3 && w <= 5 ? "width:" + (100 - 4 * w) / w + "%;margin:6px 2%;" : w > 5 && w <= 10 ? "width:" + (100 - 2 * w) / w + "%;margin:6px 1%;" : w > 10 ? "width:" + (100 - w) / w + "%;margin:5px 0.5%;" : "width:40%;margin:5%;"; for (var I = 0; I < C.length; I++) { var $ = C[I], _ = s.toolIdPrefix + n + "_" + $.key, D = $.text, N = $.title ? $.title : "", E = $.icon, M = $.bgColor, F = 0 != $.click, O = 1 == $.drag; o.initItemCall($, k.call, ["click", "drag"]); var T = ""; r.isEmpty(M) || (T = T + "background-color:" + M + ";"); var A = { name: "span", properties: { id: _, style: b + T + P, title: N } }; O ? A.properties.onmousedown = e + ".parts.drawBoard.tool.drag('" + n + "','" + x + "','" + $.key + "')" : F && (A.properties.onclick = e + ".parts.drawBoard.tool.click('" + n + "','" + x + "','" + $.key + "')"), r.isEmpty(E) ? A.text = D : A.children = [{ name: "img", properties: { src: E, width: "100%", height: "100%" } }], y.push(A) } x != v.length - 1 && (y.push(t.tags.brConfig[0]), y.push({ name: "div", properties: { class: "p-divide-line" }, text: "" })) } var S = g.children[1]; return S.properties.id = s.drawIdPrefix + n, f ? S.properties.onmousedown = e + ".parts.drawBoard.region('" + n + "')" : S.properties.onclick = e + ".parts.drawBoard.click('" + n + "')", l["part" + n] = { id: n, params: i, config: g, shape: {}, connects: {} } }, getCurr: m.getCurr, getConfig: m.getConfig, click: m.click, region: m.region, zoom: m.zoom, tool: { click: h.click, drag: h.drag }, shape: { create: v.create, dblclick: v.dblclick, getConfig: v.getConfig, change: v.change, drag: v.drag, checked: v.checked, uncheckAll: v.uncheckAll, delete: v.delete, deleteAll: v.deleteAll }, connect: { create: g.create, add: g.add, checked: g.checked, uncheckAll: g.uncheckAll, delete: g.delete, deleteAll: g.deleteAll } } }, svg: new function () { var t = n.svg, i = {}, s = {}, l = { name: "svg", properties: { width: "100%", height: "100%", version: "1.1", xmlns: "http://www.w3.org/2000/svg" }, children: [] }, p = { rect: { name: "rect", properties: { x: "0", y: "0", width: "50px", height: "50px", fill: "black", stroke: "black", "stroke-width": "2" }, text: "" }, circle: { name: "circle", properties: { cx: "0", cy: "0", r: "", fill: "black", stroke: "black", "stroke-width": "2" }, text: "" }, image: { name: "image", properties: { "xlink:href": "", x: "0", y: "0", height: "100%", width: "100%" }, text: "" }, text: { name: "text", properties: { x: "50%", y: "50%", dy: ".3em", fill: "red", "text-anchor": "middle", "font-size": "12px" }, text: "" } }, c = { getConfig: function (e) { return o.getConfig(e, i) }, click: function (e) { var t = i["part" + e]; if (t) { var a = t.params; r.callFn(window.ui, a.call.click.fn, a.call.click.params, t) } }, dblclick: function (e) { var t = i["part" + e]; if (t) { var a = t.params; r.callFn(window.ui, a.call.dblclick.fn, a.call.dblclick.params, t) } } }, d = { click: function (e, t) { var i = s["svg" + e]; if (i) { var a = i["element" + t]; if (a) { var n = a.params; r.callFn(window.ui, n.call.click.fn, n.call.click.params, a.params) } } }, dblclick: function (e, t) { var i = s["svg" + e]; if (i) { var a = i["element" + t]; if (a) { var n = a.params; r.callFn(window.ui, n.call.dblclick.fn, n.call.dblclick.params, a.params) } } }, get: function (e, t) { var r = void 0, i = s["svg" + e]; if (i) if (t) { var a = i["element" + t]; a && (r = a.params) } else r = i; return r }, add: function (e, r) { var i = f(e, r), a = ui.build.buildModule(i.config); $("#" + t.idPrefix + e).html($("#" + t.idPrefix + e).html() + a) }, change: function (e, r, i, a, n) { var o = s["svg" + e]; if (o) { var l = o["element" + r]; if (l) { var p = l.params; p.properties || (p.properties = {}), p.other || (p.other = {}); var c = $("#" + t.elementNamePrefix + r); if (i) for (var d in i) if (i.hasOwnProperty(d)) { var f = i[d]; c.attr(d, f), p.properties[d] = f } if (n) for (var u in n) if (n.hasOwnProperty(u)) { var m = n[u]; p.other[u] = m } if (a && a.length > 0) { ";" != (a = a.replace(/(\s*$)/g, "")).charAt(a.length - 1) && (a += ";"); var h = c.attr("style"); h = h || "", c.attr("style", a + h) } } } }, remove: function (e, r) { $("#" + t.elementNamePrefix + r).remove(); var i = s["svg" + e]; if (i) { var a = i["element" + r]; a && (a.params, delete i["element" + r]) } } }; function f(i, n) { var l = n.id, c = n.title ? n.title : "", d = n.text, f = n.type, u = n.properties ? n.properties : {}, m = 1 == n.click, h = 1 == n.dblclick; r.isEmpty(l) && (l = n.id = r.getUuid(a)), n.call || (n.call = {}), n.call.click || (n.call.click = {}), n.call.dblclick || (n.call.dblclick = {}), o.initCall(n, ["click", "dblclick"]); var v = r.deepCopy(p[f]); for (var g in v.properties.id = t.elementNamePrefix + l, v.properties.title = c, d && (v.text = d), n.call.click && 0 != m && (v.properties.onclick = e + ".parts.svg.element.click('" + i + "','" + l + "')"), n.call.dblclick && 0 != h && (v.properties.ondblclick = e + ".parts.svg.element.dblclick('" + i + "','" + l + "')"), u) u.hasOwnProperty(g) && (v.properties[g] = u[g]); var y = s["svg" + i]; return y || (y = s["svg" + i] = {}), y["element" + l] = { id: l, params: n }, { id: l, params: n, config: v } } return { build: function (n) { var s = n.id, p = n.style, c = n.elements, d = 1 == n.click, u = 1 == n.dblclick; r.isEmpty(s) && (n.id = s = r.getUuid(a)), o.initCall(n, ["click", "dblclick"]); var m = r.deepCopy(l); m.properties.id = t.idPrefix + s, m.properties.style = p, n.call.click && 0 != d && (m.properties.onclick = e + ".parts.svg.click('" + s + "')"), n.call.dblclick && 0 != u && (m.properties.ondblclick = e + ".parts.svg.dblclick('" + s + "')"); for (var h = 0; h < c.length; h++) { var v = f(s, c[h]); m.children.push(v.config) } return i["part" + s] = { id: s, params: n, config: m } }, getConfig: c.getConfig, click: c.click, dblclick: c.dblclick, element: { click: d.click, dblclick: d.dblclick, get: d.get, add: d.add, change: d.change, remove: d.remove } } }, lineMap: new function () { var e = n.lineMap, t = {}, i = {}, o = { name: "div", properties: { style: "width:100%;height:100%;" }, children: [{ name: "svg", properties: { width: "100%", height: "100%", version: "1.1", xmlns: "http://www.w3.org/2000/svg" }, children: [] }] }, s = { line: { name: "line", properties: { x1: "0", y1: "0", x2: "0", y2: "0", stroke: "black", "stroke-width": "2" }, text: "" }, polyline: { name: "polyline", properties: { points: "0,0 0,0", stroke: "black", "stroke-width": "2" }, text: "" }, path: { name: "path", properties: { d: "", stroke: "black", "stroke-width": "2" }, text: "" } }, l = { set: function (e, r, i) { var a = i.z, n = i.points, o = i.direction ? i.direction : {}, s = o.x ? o.x : "auto", l = o.y ? o.y : "auto", p = t["position_" + e]; p || (p = t["position_" + e] = { id: e, xData: {}, yData: {}, lines: {} }); for (var c = (p.lines["line_" + r] = { id: r, z: a, points: [], next: function (e, t) { var r = e + "," + t, i = this.points, a = i.indexOf(r); if (a > -1 && a < i.length - 1) { var n = i[a + 1].split(","); return { x: n[0], y: n[1] } } } }).points, d = n.split(" "), f = 0; f < d.length - 1; f++) { var u = d[f], m = d[f + 1], h = u.split(","), v = m.split(","); if (2 == h.length && 2 == v.length) { var g = parseInt(h[0]), y = parseInt(h[1]), x = parseInt(v[0]), b = parseInt(v[1]), k = p.xData, w = (p.yData, k["X" + g]), P = k["X" + x]; w || (w = k["X" + g] = { value: g, yData: {} }), P || (P = k["X" + x] = { value: x, yData: {} }); var C = w.yData["Y" + y], I = P.yData["Y" + b]; C || (C = w.yData["Y" + y] = { value: y }), I || (I = P.yData["Y" + b] = { value: b }), C["line" + r] = { id: r, type: "start", z: a }, I["line" + r] = { id: r, type: "end", z: a }, "auto" == s && (s = g > x ? -1 : 1), "auto" == l && (l = y > b ? -1 : 1); for (var $ = Math.abs(x - g), _ = Math.abs(b - y), D = $ >= _ ? $ : _, N = 0; N <= D; N++) { var E = g + s * ($ >= _ ? N : Math.round($ * N / _)), M = y + l * ($ >= _ ? Math.round(_ * N / $) : N); c.push(E + "," + M) } } } }, get: function (e, r) { var i = t["position_" + e]; console.log("positionObj:", i) }, getNextPoints(e, r, i, a) { var n = parseInt(i.x), o = parseInt(i.y); i.z && parseInt(i.z), a = a || 1; var s = t["position_" + e], l = []; if (s) { var p = !1, c = s.lines, d = s.xData["X" + n]; if (d) { var f = d.yData["Y" + o]; if (f) for (var u in f) if (f.hasOwnProperty(u) && "value" != u) { var m = f[u], h = c["line_" + m.id]; m.id == r && (p = !0), h && ("start" != m.type && "all" != m.type || (v = h.next(d.value, f.value)) && l.push({ id: m.id, x: v.x, y: v.y, z: m.z })) } } if (r && !p) { var v, g = c["line_" + r]; (v = g.next(n, o)) && l.push({ id: g.id, x: v.x, y: v.y, z: g.z }) } } return l } }; return { build: function (t) { var n = t.id, p = (t.style, t.elements); r.isEmpty(n) && (t.id = n = r.getUuid(a)); for (var c = r.deepCopy(o), d = 0; d < p.length; d++) { var f = p[d], u = f.id, m = f.type ? f.type : "line", h = f.z, v = f.direction, g = f.properties; r.isEmpty(u) && (lelementId = f.id = r.getUuid(a)); var y = r.deepCopy(s[m]); for (var x in y.properties.id = e.lineIdPrefix + u, g) g.hasOwnProperty(x) && (y.properties[x] = g[x]); c.children[0].children.push(y), "line" == m ? l.set(n, u, { points: g.x1 + "," + g.y1 + " " + g.x2 + "," + g.y2, direction: v, z: h }) : "polyline" == m && l.set(n, u, { points: g.points, direction: v, z: h }) } return i["part" + n] = { id: n, params: t, config: c } }, position: { get: l.get, getNextPoints: l.getNextPoints } } }, custom: new function () { var e = n.custom, t = {}, i = { div: { name: "div", properties: { style: "width:100%;height:100%;" } }, iframe: { name: "iframe", properties: { frameborder: "0", width: "100%", height: "100%", src: "" }, text: "" } }; return customFn = { getConfig: function (e) { return o.getConfig(e, t) } }, { build: function (n) { var o, s = n.id, l = n.type, p = n.content, c = n.properties; for (var d in r.isEmpty(s) && (n.id = s = r.getUuid(a)), "iframe" == l ? o = r.deepCopy(i.iframe) : "include" == l ? (o = r.deepCopy(i.div), r.ajax({ method: "GET", url: p, async: !1, success: function (e) { o.text = e } })) : (o = r.deepCopy(i.div), r.is.Object(p) ? o.children = [p] : r.is.Array(p) ? o.children = p : o.text = p), o.properties.id = e.idPrefix + s, c) c.hasOwnProperty(d) && (o.properties[d] = c[d]); return t["part" + s] = { id: s, params: n, config: o } }, getConfig: customFn.getConfig } }, table: new function () { var i = n.table, l = {}, p = { name: "div", properties: { class: "p-table" }, children: [{ name: "table", properties: {}, children: [{ name: "thead", properties: {}, children: [] }, { name: "tbody", properties: {}, children: [] }] }] }, c = { tr: { name: "tr", properties: {}, children: [] }, th: { name: "th", properties: {} }, td: { name: "td", properties: {} }, check: { name: "input", properties: { type: "checkbox" } }, operation: { name: "span", properties: { class: "p-table-operation" } } }; function d(t, a, n, o, s, l) { var p = r.deepCopy(c.tr); if (1 == s) { var d = r.deepCopy(c.td); if (n) { var f = r.deepCopy(c.check); f.properties.name = i.checkIdPrefix + t, d.children = [f] } else d.text = ""; p.children.push(d) } for (var u in 1 == o && ((d = r.deepCopy(c.td)).text = n && n.$index ? n.$index : "", p.children.push(d)), a) if (a.hasOwnProperty(u)) { var m = u; (d = r.deepCopy(c.td)).properties.name = i.colNamePrefix + m, d.text = n ? n[m] : "", p.children.push(d) } if (l) { if (d = r.deepCopy(c.td), n) { for (var h in d.children = [], l) if (l.hasOwnProperty(h)) { var v = l[h]; v.key = h; var g = r.deepCopy(c.operation); g.text = v.name, g.properties.onclick = e + ".parts.table.row.operation('" + t + "','" + (parseInt(n.$index) - 1) + "','" + h + "')", d.children.push(g) } } else d.text = ""; p.children.push(d) } return p } function f(t) { var n = t.id, f = t.align, u = t.bodyAlign, m = 1 == t.dblclick, h = 1 == t.showIndex, v = 1 == t.showCheck, g = t.header ? t.header : {}, y = t.operations, x = t.body; r.isEmpty(n) && (t.id = n = r.getUuid(a)), o.initCall(t, ["dblclick"]), tableDivElement = r.deepCopy(p), tableElement = tableDivElement.children[0], tableElement.properties.id = i.idPrefix + n, (!f || "center" != f && "left" != f && "right" != f) && (f = i.defaultHeaderAlign), (!u || "center" != u && "left" != u && "right" != u) && (u = i.defaultBodyAlign), tableElement.children[0].properties.class = s.align + f, tableElement.children[1].properties.class = s.align + u; var b = r.deepCopy(c.tr); if (1 == v) { var k = r.deepCopy(c.th), w = r.deepCopy(c.check); w.properties.name = i.checkAllIdPrefix + n, w.properties.onclick = e + ".parts.table.row.check('" + n + "', this.checked)", k.children = [w], b.children.push(k) } for (var P in 1 == h && ((k = r.deepCopy(c.th)).text = "INDEX", b.children.push(k)), g) if (g.hasOwnProperty(P)) { var k = r.deepCopy(c.th), C = g[P]; k.properties.name = i.colNamePrefix + C, k.text = C, b.children.push(k) } y && ((k = r.deepCopy(c.th)).text = "操作", b.children.push(k)), tableElement.children[0].children.push(b); for (var I = 0; I < x.length; I++) { var $ = x[I]; $.$index = I + 1 + ""; var _ = d(n, g, $, h, v, y); 1 == m && t.call.dblclick && (_.properties.ondblclick = e + ".parts.table.row.dblclick('" + n + "', '" + (parseInt($.$index) - 1) + "')"), tableElement.children[1].children.push(_) } if (i.defaultRowCount > x.length) for (var D = i.defaultRowCount - x.length, N = 0; N < D; N++)_ = d(n, g, void 0, h, v, y), tableElement.children[1].children.push(_); return l["part" + n] = { id: n, params: t, config: tableDivElement } } return tableFn = { getConfig: function (e) { return o.getConfig(e, l) }, getChecked: function (e) { var t = $("#" + i.idPrefix + e).children("tbody"), r = 0, a = []; return t.find("input[name='" + i.checkIdPrefix + e + "']").each(function () { $(this).prop("checked") && a.push(data[r]), r++ }), a }, removeChecked: function (e) { var t = o.getConfig(e, l).body, r = $("#" + i.idPrefix + e).children("tbody"), a = 0, n = []; return r.find("input[name='" + i.checkIdPrefix + e + "']").each(function () { $(this).prop("checked") ? (n.push(t[a]), $(this).parents("tr").remove(), t.splice(a, 1)) : a++ }), n } }, colFn = { add: function (e, t, r) { }, remove: function (e, t) { var r = l["part" + e]; if (r) { var a = r.params.header, n = a.indexOf(5); n > 0 && (a.splice(n, 1), $("#" + i.idPrefix + e).find(td["name='" + i.colNamePrefix + t + "'"]).remove()) } }, edit: function (e, r, a) { var n = l["part" + e]; if (n && a) { var o = n.params; o.header = r, o.body = a, console.log(r); var s = f(o), p = t.buildModule(s.config); $("#" + i.idPrefix + e).parent().html(p) } } }, rowFn = { dblclick: function (e, t) { var i = l["part" + e]; if (i) { var a = i.params.call, n = i.params.body[t]; r.callFn(window.ui, a.dblclick.fn, a.dblclick.params, { tableId: e, index: t, data: n }) } }, check: function (e, t, r) { null == t && (t = "auto"); var a = $("#" + i.idPrefix + e).children("tbody"); if (r) { var n = a.find("input[name='" + i.checkIdPrefix + e + "']:eq('" + r + "')"); 1 == t ? n.prop("checked", !0) : 0 == t ? n.prop("checked", !1) : n.prop("checked", 1 != n.prop("checked")) } else a.find("input[name='" + i.checkIdPrefix + e + "']").each(function () { 1 == t ? $(this).prop("checked", !0) : 0 == t ? $(this).prop("checked", !1) : $(this).prop("checked", 1 != $(this).prop("checked")) }) }, operation: function (e, t, i) { var a = l["part" + e]; if (a) { var n = a.params.body[t], o = a.params.operations[i], s = { tableId: e, index: t, data: n, operation: o }; r.callFn(window.ui, o.fn, o.params, s) } }, add: function (e, r, a) { var n = l["part" + e]; if (n) { (!a || a < 0) && (a = 0); var o = d(e, n.params.header, r, n.params.showIndex, n.params.showCheck, n.params.operations); $("#" + i.idPrefix + e).children("tbody").children("tr:eq(" + a + ")").before(t.buildModule([o])), n.params.body.splice(a, 0, r) } }, remove: function (e, t) { var r = l["part" + e]; r && (t ? (r.params.body.splice(t, 1), $("#" + i.idPrefix + e).children("tbody").children("tr:eq(" + t + ")").remove()) : (r.params.body = [], $("#" + i.idPrefix + e).children("tbody").children("tr").remove())) }, getData: function (e, t) { var r = l["part" + e]; if (r) return r.params.body[t] }, setData: function (e, r, a) { var n = l["part" + e]; if (n) { var o = n.params.header, s = n.params.showIndex, p = n.params.showCheck, c = n.params.operations; if (a) r.$index = a + 1 + "", x = d(e, o, r, s, p, c), $("#" + i.idPrefix + e).children("tbody").children("tr:eq(" + a + ")").html(x), n.params.body.splice(a, 0, r); else { n.params.body = r; for (var f = [], u = 0; u < r.length; u++) { var m = r[u]; m.$index = u + 1 + ""; var h = d(e, o, m, s, p, c); f.push(h) } if (i.defaultRowCount > r.length) for (var v = i.defaultRowCount - r.length, g = 0; g < v; g++) { var y = d(e, o, void 0, s, p, c); f.push(y) } var x = t.buildModule(f); $("#" + i.idPrefix + e).children("tbody").html(x) } } } }, { build: f, getConfig: tableFn.getConfig, getChecked: tableFn.getChecked, removeChecked: tableFn.removeChecked, col: { add: colFn.add, remove: colFn.remove, edit: colFn.edit }, row: { dblclick: rowFn.dblclick, check: rowFn.check, operation: rowFn.operation, add: rowFn.add, remove: rowFn.remove, getData: rowFn.getData, setData: rowFn.setData } } }, tabs: new function () { var i = n.tabs, s = {}, l = { name: "div", properties: { class: "p-tabs" }, children: [{ name: "ul", properties: { class: "p-tabs-title" }, children: [] }, { name: "div", properties: { class: "p-tabs-body" }, children: [] }] }, p = { title: { name: "li", properties: {}, children: [{ name: "span", properties: { class: "p-left" }, text: "" }, { name: "span", properties: { class: "p-right" }, text: "x" }] }, body: { name: "div", properties: { class: "p-tabs-tab" } } }; function c(t, n, s) { var l = n.id, c = n.default, d = n.title, f = n.body, u = 0 != n.close; r.isEmpty(l) && (n.id = l = r.getUuid(a)), o.initItemCall(n, s, ["checked", "close"]); var m = r.deepCopy(p.title); d.style && (m.properties.style = d.style), m.properties.onclick = e + ".parts.tabs.tab.checked('" + t + "','" + l + "')", m.properties.name = i.tabNamePrefix + l, m.children[0].text = d.text ? d.text : "", m.children[1].properties.onclick = e + ".parts.tabs.tab.close('" + t + "','" + l + "')", c && (m.properties.class = "p-checked"), u || m.children.splice(1, 1); var h = r.deepCopy(p.body); return c && (h.properties.class += " p-checked"), f.style && (h.properties.style = f.style), h.properties.name = i.tabNamePrefix + l, o.buildBody(h, f.content), { id: l, params: n, config: { title: m, body: h } } } return tabsFn = { getConfig: function (e) { return o.getConfig(e, s) } }, tabFn = { open: function (e, a) { var n = s["part" + e]; if (n) { var o = c(e, a, n.params.call); $("#" + i.idPrefix + e).children("ul").append(t.buildModule(o.config.title)), $("#" + i.idPrefix + e).children("div").append(t.buildModule(o.config.body)), n.tabs["tab" + o.id] = o, tabFn.checked(e, o.id), n.params.call.open.fn && r.callFn(window.ui, n.params.call.open.fn, n.params.call.open.params, a) } }, checked: function (e, t) { var a = s["part" + e]; if (a) { if (!t) for (var n in a.tabs) if (a.tabs.hasOwnProperty(n)) { t = a.tabs[n].id; break } var o = a.tabs["tab" + t]; if (o) { var l = $("#" + i.idPrefix + e).children("ul").children("li[name='" + i.tabNamePrefix + t + "']"); l.addClass("p-checked"), l.siblings("li").removeClass("p-checked"); var p = $("#" + i.idPrefix + e).children("div").children("div[name='" + i.tabNamePrefix + t + "']"); p.addClass("p-checked"), p.siblings("div").removeClass("p-checked"), o.params.call.checked.fn && r.callFn(window.ui, o.params.call.checked.fn, o.params.call.checked.params, o) } } }, close: function (e, t) { var a = s["part" + e]; if (a) { var n = a.tabs["tab" + t]; if (n) { var o = $("#" + i.idPrefix + e).children("ul").children("li[name='" + i.tabNamePrefix + t + "']"), l = $("#" + i.idPrefix + e).children("div").children("div[name='" + i.tabNamePrefix + t + "']"); o.remove(), l.remove(), delete a.tabs["tab" + t], 0 == $("#" + i.idPrefix + e).children("ul").children(".p-checked").length && this.checked(e), n.params.call.close.fn && r.callFn(window.ui, n.params.call.close.fn, n.params.call.close.params, n), (window.event || arguments.callee.caller.arguments[0]).stopPropagation() } } } }, { build: function (e) { var t = e.id, n = e.elements; r.isEmpty(t) && (e.id = t = r.getUuid(a)), o.initCall(e, ["checked", "open", "close"]); var p = !1; tabsElement = r.deepCopy(l), tabsElement.properties.id = i.idPrefix + t; for (var d = {}, f = 0; f < n.length; f++) { var u = n[f]; 1 == u.default && 1 == p && (u.default = !1), 1 == u.default && (p = !0); var m = c(t, u, e.call); tabsElement.children[0].children.push(m.config.title), tabsElement.children[1].children.push(m.config.body), d["tab" + m.id] = m } return s["part" + t] = { id: t, params: e, config: tabsElement, tabs: d } }, getConfig: tabsFn.getConfig, tab: { checked: tabFn.checked, open: tabFn.open, close: tabFn.close } } }, page: new function () { var i = n.page, s = {}, l = { name: "div", properties: { class: "p-page" }, children: [] }, p = { page: { name: "span", properties: {}, text: "" }, next: { name: "span", properties: {}, text: "" }, last: { name: "span", properties: {}, text: "" }, input: { name: "span", properties: {}, children: [{ name: "span", properties: {}, text: "" }, { name: "input", properties: { type: "text" } }] }, firstly: { name: "span", properties: {}, text: "" }, finally: { name: "span", properties: {}, text: "" } }; function c(t, a) { var n = [], o = a.curr ? parseInt(a.curr) : 1, s = a.maxPage, l = a.showSize ? parseInt(a.showSize) : 10, c = (a.flushType, a.last = 0 != a.last), d = a.next = 0 != a.next, f = a.input = 0 != a.input, u = a.firstly = 0 != a.firstly, m = a.finally = 0 != a.finally; if (o < 1 && (o = 1), u) { var h = r.deepCopy(p.firstly); h.text = i.firstlyText, 1 == o ? h.properties.class = "p-forbid" : h.properties.onclick = e + ".parts.page.click('" + t + "', '1')", n.push(h) } if (c) { var v = 1 == o ? 1 : o - 1, g = r.deepCopy(p.last); g.text = i.lastText, 1 == o ? g.properties.class = "p-forbid" : g.properties.onclick = e + ".parts.page.click('" + t + "', '" + v + "')", n.push(g) } l > s && (l = s); var y, x, b = l % 2 == 1, k = parseInt(l / 2); for (o <= k ? (y = 1, x = l) : o > s - k ? (y = s - l + 1, x = s) : (y = o - k, b || (y += 1), x = o + k); y <= x; y++) { var w = r.deepCopy(p.page); o == y ? w.properties.class = "p-checked" : w.properties.onclick = e + ".parts.page.click('" + t + "', '" + y + "')", w.text = y, n.push(w) } if (f) { var P = r.deepCopy(p.input); P.children[0].text = i.toText + " ", P.children[1].properties.onblur = e + ".parts.page.click('" + t + "', this.value)", n.push(P) } if (d) { var C = o >= s ? s : o + 1, I = r.deepCopy(p.next); I.text = i.nextText, o == s ? I.properties.class = "p-forbid" : I.properties.onclick = e + ".parts.page.click('" + t + "', '" + C + "')", n.push(I) } if (m) { var $ = r.deepCopy(p.finally); $.text = i.finallyText, o == s ? $.properties.class = "p-forbid" : $.properties.onclick = e + ".parts.page.click('" + t + "', '" + s + "')", n.push($) } return n } return pageFn = { getConfig: function (e) { return o.getConfig(e, s) }, getCurr: function (e) { return s["part" + e], o.getCurr(e, s) }, click: function (e, a) { var n = s["part" + e]; if (n) { var o = n.params; if (o.curr = a ? parseInt(a) : 1, 0 != a.isFlush) { var l = t.buildModule(c(e, o)); $("#" + i.idPrefix + e).html(l) } r.callFn(window.ui, o.call.click.fn, o.call.click.params, o) } }, flush: function (e) { var r = s["part" + e]; if (r) { var a = t.buildModule(c(e, r.params)); $("#" + i.idPrefix + e).html(a) } } }, { build: function (e) { var t = e.id; return r.isEmpty(t) && (e.id = t = r.getUuid(a)), e.call || (e.call = {}), e.call.click || (e.call.click = {}), pageElement = r.deepCopy(l), pageElement.properties.id = i.idPrefix + t, pageElement.children = c(t, e), s["part" + t] = { id: t, params: e, config: pageElement } }, getConfig: pageFn.getConfig, getCurr: pageFn.getCurr, flush: pageFn.flush, click: pageFn.click } }, nav: new function () { var t = n.nav, i = {}, l = { name: "div", properties: { class: "p-nav" }, children: [{ name: "div", properties: { class: "p-nav-bar" }, children: [{ name: "div", properties: { class: "p-nav-img" }, children: [{ name: "img", properties: { height: "100%" } }] }, { name: "div", properties: { class: "p-nav-title" }, text: "" }, { name: "div", properties: { class: "p-nav-main" }, children: [] }, { name: "div", properties: { class: "p-nav-tool" }, text: "" }] }, { name: "div", properties: { class: "p-nav-children" }, children: [] }] }, p = { name: "div", properties: { class: "p-nav-list" }, children: [] }, c = { name: "div", properties: { class: "p-nav-group" }, children: [{ name: "div", properties: { class: "p-title" }, text: "" }, { name: "div", properties: { class: "p-children" }, children: [] }] }, d = { name: "span", properties: { class: "p-nav-node" }, text: "" }; function f(i, n, s) { var l = n.id, f = n.style, u = n.gread, m = n.groups; r.isEmpty(l) && (n.id = l = r.getUuid(a)), o.initItemCall(n, s, ["click"]); var h = r.deepCopy(p); if (h.properties.id = t.listIdPrefix + i + "_" + l, h.properties.gread = u, f && (h.properties.style = f), !m) { m = [], P = n.nodes; for (var v = 0; v < P.length; v++) { var g = P[v]; m.push(g) } } for (var y = {}, x = 0; x < m.length; x++) { var b = m[x], k = b.id, w = b.title, P = b.nodes; r.isEmpty(k) && (k = b.id = r.getUuid(a)), o.initItemCall(b, n.call, ["click"]), P ? r.is.Array(P) || (P = [P]) : P = [b]; var C = r.deepCopy(c); C.properties.name = t.groupIdPrefix + k, w ? C.children[0].text = w : C.children.splice(0, 1); var I = C.children[C.children.length - 1]; for (v = 0; v < P.length; v++) { var $ = (g = P[v]).id, _ = g.text; r.isEmpty($) && ($ = g.id = r.getUuid(a)), o.initItemCall(g, b.call, ["click"]); var D = r.deepCopy(d); D.properties.name = t.nodeIdPrefix + $, D.properties.onclick = e + ".parts.nav.checked('" + i + "','" + l + "','" + $ + "')", D.text = _, I.children.push(D), y["node" + $] = g } h.children.push(C) } return { id: l, params: n, config: h, nodes: y } } return navFn = { getConfig: function (e) { return o.getConfig(e, i) }, init: function (e, t) { }, checked: function (e, a, n) { var o = i["part" + e]; if (o) { var s = o.list["list" + a]; if (s) { var l = s.nodes["node" + n]; if (l) { if (l.to && o.list["list" + l.to]) { var p = s.params.gread, c = $("#" + t.listIdPrefix + e + "_" + l.to); c.css("display", "block"), c.siblings().each(function () { $(this).attr("gread") == p + 1 && $(this).css("display", "none") }) } !function (e, r, a) { var n = i["part" + e]; if (n) { var o = n.list["list" + r], s = o.params.gread ? o.params.gread : 0; if (o) { var l = o.nodes["node" + a]; if ($("#" + t.listIdPrefix + e + "_" + l.to), a && l) { n.curr || (n.curr = []), n.curr[s] = { listId: r, nodeId: l.id }; var p = $("#" + t.listIdPrefix + e + "_" + r), c = o.params.gread; $("#" + t.idPrefix + e).find(".p-nav-list").each(function () { var e = $(this).attr("gread"); e >= c && $(this).find(".p-nav-active").removeClass("p-nav-active") }), p.find("*[name='" + t.nodeIdPrefix + a + "']").addClass("p-nav-active") } } } }(e, a, n), l.call && r.callFn(window.ui, l.call.click.fn, l.call.click.params, l) } } } }, unCheckedAll: function (e) { i["part" + e] && $("#" + t.idPrefix + e + " .p-nav-children").children().css("display", "none") } }, { build: function (n) { var p = n.id, c = n.align ? n.align : "center", d = n.img, u = n.title, m = n.tool, h = n.main, v = n.list; r.isEmpty(p) && (n.id = p = r.getUuid(a)), o.initCall(n, ["click"]), r.is.Array(h) ? h = { id: "main", gread: 0, groups: h } : h.gread || (h.gread = 0), navElement = r.deepCopy(l), navElement.properties.id = t.idPrefix + p, navElement.properties.onmouseleave = e + ".parts.nav.unCheckedAll('" + p + "')"; var g = 0, y = 0, x = 0; if (d) { g = d.width ? d.width : 5; var b = navElement.children[0].children[0]; b.properties.style = "width:" + g + "%;", b.children[0].properties.src = d.src } if (u) { y = u.width ? u.width : 15; var k = navElement.children[0].children[1]; k.properties.style = "width:" + y + "%;", k.text = u.text } m && (x = m.width ? m.width : 20, navElement.children[0].children[3].properties.style = "width:" + x + "%;"); var w = 100 - g - y - x, P = navElement.children[0].children[2]; P.properties.style = "width:" + w + "%;", P.properties.class += " " + s.align + c; var C = {}, I = f(p, h, n.call); if (P.children.push(I.config), C["list" + I.id] = I, v) for (var $ = navElement.children[1], _ = 0; _ < v.length; _++) { var D = f(p, v[_], n.call); $.children.push(D.config), C["list" + D.id] = D } return i["part" + p] = { id: p, params: n, config: navElement, list: C } }, getConfig: navFn.getConfig, checked: navFn.checked, unCheckedAll: navFn.unCheckedAll } }, content: new function () { var t = n.content, i = {}, s = { name: "div", properties: { class: "p-content" }, children: [] }, l = { img: { name: "div", properties: { class: "p-content-img" }, children: [] }, title: { name: "div", properties: { class: "p-content-title" }, children: [] }, text: { name: "div", properties: { class: "p-content-text" }, children: [] }, operations: { name: "div", properties: { class: "p-content-operations" }, children: [] }, spanTab: { name: "span", properties: {}, children: [] }, imgTab: { name: "img", properties: { src: "", width: "100%", height: "100%" } } }; return { build: function (n) { var p = n.id, c = "L" == n.type ? "L" : "H", d = n.col ? n.col : 1, f = n.style ? n.style : ""; r.isEmpty(p) && (n.id = p = r.getUuid(a)); var u = r.deepCopy(s); u.properties.id = t.idPrefix + p, d > 1 && (f = "width:" + parseInt(100 / d - 2) + "%;" + f), f && "" != f && (u.properties.style = f); var m = " p-content-w28", h = " p-content-w68"; for (var v in "L" != c && n.img || (m = h = " p-content-w100"), n) if (n.hasOwnProperty(v)) { var g = n[v]; if ("img" == v) { var y = g, x = y.url ? y.url : "", b = y.style, k = r.deepCopy(l.img); k.properties.name = "content_img", k.properties.class += m, b && (k.properties.style = b); var w = r.deepCopy(l.imgTab); w.properties.src = x, k.children.push(w), u.children.push(k) } else if ("title" == v) { var P = g, C = P.text ? P.text : "", I = P.style; o.initCall(P, ["click"]); var $ = r.deepCopy(l.title); $.properties.name = "content_title", $.properties.class += h, P.call.click && 0 != P.click && ($.properties.onclick = e + ".parts.content.title.click('" + p + "')"), I && ($.properties.style = I), $.text = C, u.children.push($) } else if ("operations" == v) { var _ = g, D = _.style, N = _.elements ? _.elements : []; o.initCall(_, ["click"]); var E = r.deepCopy(l.operations); E.properties.name = "content_operations", E.properties.class += h, D && (E.properties.style = D); for (var M = 0; M < N.length; M++) { var F = N[M], O = F.key, T = F.position, A = F.text, S = F.img; o.initItemCall(F, _.call, ["click"]); var j = r.deepCopy(l.spanTab); if (j.properties.name = t.operationNamePrefix + O, F.call.click && 0 != F.click && (j.properties.onclick = e + ".parts.content.operation.click('" + p + "','" + O + "')"), j.properties.class = "right" == T ? "p-operation p-right" : "p-operation p-left", S) { var z = r.deepCopy(l.imgTab); z.properties.src = S, j.children.push(z) } if (A) { var B = r.deepCopy(l.spanTab); B.text = A, j.children.push(B) } E.children.push(j) } u.children.push(E) } else if ("text" == v) { var U = g, L = U.style, R = U.text, X = U.elements, q = r.deepCopy(l.text); q.properties.name = "content_text", q.properties.class += h, L && (q.properties.style = L), r.isEmpty(R) || (X = [R]); for (var G = 0; G < X.length; G++) { var W = r.deepCopy(l.spanTab); W.text = X[G], q.children.push(W) } u.children.push(q) } } return i["part" + p] = { id: p, params: n, config: u } }, getConfig: function (e) { return o.getConfig(e, i) }, title: { click: function (e) { var t = i["part" + e]; if (t) { var a = t.params.title; r.callFn(window.ui, a.call.click.fn, a.params, t.params) } } }, operation: { click: function (e, t) { var a = i["part" + e]; if (a && t) for (var n = a.params.operations.elements, o = 0; o < n.length; o++) { var s = n[o]; if (s.key == t) { var l = { operation: s, content: a.params }; r.callFn(window.ui, s.call.click.fn, s.call.click.params, l); break } } event.stopPropagation() } } } }, list: new function () { var i = n.list, s = {}, l = { name: "div", properties: { class: "p-list" }, children: [] }, p = { name: "div", properties: { class: "p-list-item" }, children: [{ name: "div", properties: { class: "p-item-check" } }, { name: "div", properties: { class: "p-item-content" } }] }, c = { name: "div", properties: { class: "p-list-none" }, children: [{ name: "span", text: "暂无数据" }] }, d = { getConfig: function (e) { return o.getConfig(e, s) }, empty: function (e) { var t = s["part" + e]; if (t) { var r = t.items; return $("#" + i.idPrefix + e).html(""), t.items = {}, $("#" + i.idPrefix + e).children(".p-list-none").css("display", "inline-block"), r } }, edit: function (e, t) { if (s["part" + e]) { var r = $("#" + i.idPrefix + e); if (1 != t && 0 != t && (t = !r.is(".p-list-edit")), t) { r.addClass("p-list-edit"); var a = r.children(".p-list-item:first"); r.find(".p-item-check").width(a.width()).height(a.height()) } else r.removeClass("p-list-edit"), r.find(".p-item-check").width(0).height(0), r.find(".p-item-check").removeClass("p-item-active") } }, getChecked: function (e) { var t = s["part" + e]; if (t) { var r = [], a = t.items; return $("#" + i.idPrefix + e).find(".p-item-active").each(function () { var e = $(this).parent(".p-list-item").attr("name"); e = e.replace(i.itemNamePrefix, ""), r.push(a["item" + e]) }), r } }, removeChecked: function (e) { var t = s["part" + e]; if (t) { var r = [], a = t.items; return $("#" + i.idPrefix + e).find(".p-item-active").each(function () { var e = $(this).parent(".p-list-item"), t = e.attr("name"); t = t.replace(i.itemNamePrefix, ""); var n = a["item" + t]; r.push(n), e.remove(), delete a["item" + t] }), 0 == $("#" + i.idPrefix + e).children(".p-list-item").length && $("#" + i.idPrefix + e).children(".p-list-none").css("display", "inline-block"), r } }, checkAll: function (e, t, r) { if (s["part" + e]) { var a = $("#" + i.idPrefix + e).find(".p-item-check"); 1 != r && 0 != r && (r = !0, a.each(function () { $(this).is(".p-item-active") || (r = !1) })), 1 == r ? a.removeClass("p-item-active") : a.addClass("p-item-active") } } }, f = { add: function (e, r) { var a = s["part" + e]; if (a) { var n = a.params.col, o = a.params.itemStyle, l = 1 == a.params.click, p = void 0; n > 1 && (p = "width:" + parseInt(100 / n) + "%;"), r.style || (r.style = o), null != p && (r.style = p + (r.style ? r.style : "")), null == r.click && (r.click = l); var c = u(e, r, a.params.call); if (c) { $("#" + i.idPrefix + e).children(".p-list-none").css("display", "none"); var d = t.buildModule(c); $("#" + i.idPrefix + e).append(d), a.items["item" + r.key] = r } } }, remove: function (e, t) { var r = s["part" + e]; r && ($("#" + i.idPrefix + e).children("*[name='" + i.itemNamePrefix + t + "']").remove(), delete r.items["item" + t], 0 == $("#" + i.idPrefix + e).children(".p-list-item").length && $("#" + i.idPrefix + e).children(".p-list-none").css("display", "inline-block")) }, check: function (e, t, r) { if (s["part" + e]) { var a = $("#" + i.idPrefix + e).children("*[name='" + i.itemNamePrefix + t + "']").children(".p-item-check"); 1 != r && 0 != r && (r = !a.is(".p-item-active")), r ? a.addClass("p-item-active") : a.removeClass("p-item-active") } }, click: function (e, t) { var i = s["part" + e]; if (i) { var a = i.items["item" + t], n = a.call; a && r.callFn(window.ui, n.click.fn, n.click.params, a) } } }; function u(t, n, s) { var l = n.key, c = n.content, d = 1 == n.click, f = n.style; r.isEmpty(l) && (n.key = l = r.getUuid(a)), o.initItemCall(n, s, ["click"]); var u = r.deepCopy(p); u.properties.name = i.itemNamePrefix + l, f && "" != f && (u.properties.style = f), u.children[0].properties.onclick = e + ".parts.list.item.check('" + t + "','" + l + "')"; var m = u.children[1]; return s.click && 0 != d && (m.properties.onclick = e + ".parts.list.item.click('" + t + "','" + l + "')"), c && o.buildBody(m, c), u } return { build: function (e) { var t = e.id, n = e.items ? e.items : [], p = 1 == e.click, d = 1 == e.edit, f = e.col ? e.col : 1, m = e.style, h = e.itemStyle; r.isEmpty(t) && (e.id = t = r.getUuid(a)), o.initCall(e, ["click"]); var v = r.deepCopy(l); v.properties.id = i.idPrefix + t, 1 == d && (v.properties.class += " p-list-edit"), m && (v.properties.style = m); var g = {}, y = void 0; f > 1 && (y = "width:" + parseInt(100 / f) + "%;"); for (var x = 0; x < n.length; x++) { var b = n[x]; b.style || (b.style = h), null != y && (b.style = y + (b.style ? b.style : "")), null == b.click && (b.click = p), v.children.push(u(t, b, e.call)), g["item" + b.key] = b } var k = r.deepCopy(c); return n && 0 != n.length ? k.properties.style = "display:none;" : k.properties.style = "display:inline-block;", v.children.push(k), s["part" + t] = { id: t, params: e, config: v, items: g } }, getConfig: d.getConfig, empty: d.empty, edit: d.edit, getChecked: d.getChecked, removeChecked: d.removeChecked, checkAll: d.checkAll, item: { add: f.add, remove: f.remove, check: f.check, click: f.click } } }, tree: new function () { var i = n.tree, l = {}, p = { name: "div", properties: { class: "p-tree" }, children: [] }, c = { ul: { name: "div", properties: { class: "p-tree-ul" }, children: [] }, li: { name: "div", properties: { class: "p-tree-li" }, children: [] }, span: { name: "span", properties: {}, text: "" } }, d = { setItems: function (e, a, n) { var o = l["part" + e]; if (o) { var s = o.items, p = s["item" + a]; if (p) { if (p.items) for (var d = 0; d < p.items.length; d++)delete s["item" + p.items[d].id]; var u = []; for (p.items = n, d = 0; d < p.items.length; d++) { var m = p.items[d]; u.push(f(e, m, s, p.gread + 1)) } var h = r.deepCopy(c.ul); h.children = u; var v = $("#" + i.idPrefix + e).find("div[name='" + i.itemNamePrefix + a + "']"); v.children(".p-tree-ul").remove(), v.html(v.html() + t.buildModule(h)) } } }, check: function (e, t) { var a = l["part" + e]; if (a) { var n = a.items["item" + t]; if (n) { var o = $("#" + i.idPrefix + e).find("div[name='" + i.itemNamePrefix + t + "']"); if (o.siblings(".p-tree-li").find(".p-tree-ul").css("display", "none"), n.items && n.items.length > 0) { var s = o.children(".p-tree-ul"), p = s.css("display"); s.css("display", "none" == p ? "block" : "none") } else $("#" + i.idPrefix + e).find("span").removeClass("p-tree-active"), o.children("span").addClass("p-tree-active"); if (n.call && n.call.click && n.call.click.fn) r.callFn(window.ui, n.call.click.fn, n.call.click.params, n); else { var c = a.params; r.callFn(window.ui, c.call.click.fn, c.call.click.params, n) } } else console.log("Tree error: ID :" + e + ", key:" + t + " is undefined!") } else console.log("Tree error: ID :" + e + " is undefined!") } }; function f(t, n, o, l) { var p = " " + s.colorGread; l || (l = 0), r.is.String(n) ? n = { text: n } : r.is.Array(n) && (n = { show: !0, items: n }); var d = n.id, u = n.text, m = 1 == n.show, h = n.items; r.isEmpty(d) && (n.id = d = r.getUuid(a)), n.gread = l; var v = r.deepCopy(c.li); if (v.properties.name = i.itemNamePrefix + d, v.properties.class += p + l, u && r.is.String(u)) { var g = r.deepCopy(c.span); g.properties.onclick = e + ".parts.tree.item.check('" + t + "','" + d + "')", g.text = u, v.children.push(g) } if (h && r.is.Array(h) && h.length > 0) { var y = r.deepCopy(c.ul); 0 == m && (y.properties.style = "display:none;"); for (var x = 0; x < h.length; x++) { var b = h[x]; y.children.push(f(t, b, o, l + 1)) } v.children.push(y) } return o["item" + d] = n, v } return { build: function (e) { var t = e.id, n = e.items ? e.items : [], s = (e.click, e.style); e.itemStyle, r.isEmpty(t) && (e.id = t = r.getUuid(a)), o.initCall(e, ["click"]); var c = r.deepCopy(p); c.properties.id = i.idPrefix + t, s && (c.properties.style = s); var d = {}, u = f(t, n, d, 0); return u && (c.children = u.children), l["part" + t] = { id: t, params: e, config: c, items: d } }, getConfig: function (e) { return o.getConfig(e, listData) }, item: { setItems: d.setItems, check: d.check } } }, accordions: new function () { var t = n.accordion, i = {}, l = { name: "div", properties: { class: "p-accordions" }, children: [] }, p = { name: "div", properties: { class: "p-accordion" }, children: [{ name: "div", properties: { class: "p-accordion-title" }, text: "" }, { name: "div", properties: { class: "p-accordion-body" }, children: [] }] }; function c(i, n, l, c) { var d = n.id, f = n.title, u = n.body, m = 1 == n.show; r.isEmpty(d) && (n.id = d = r.getUuid(a)), o.initItemCall(n, c, ["switch"]); var h = r.deepCopy(p); h.properties.id = t.itemIdPrefix + d; var v = h.children[0]; f && (v.properties.onclick = e + ".parts.accordions.item.switch('" + i + "','" + d + "')", r.is.String(f) ? v.text = f : (f.style && (v.properties.style = f.style), f.text && (v.text = f.text))); var g = h.children[1]; return 0 == m && (g.properties.class += " " + s.none), u && (u.style && (g.properties.style = u.style), o.buildBody(g, u.content)), l["item" + d] = n, h } return { build: function (e) { var n = e.id, s = e.style, p = e.items ? e.items : []; r.isEmpty(n) && (e.id = n = r.getUuid(a)), o.initCall(e, ["switch"]); var d = r.deepCopy(l); d.properties.id = t.idPrefix + n, s && (d.properties.style = s); for (var f = {}, u = 0; u < p.length; u++) { var m = c(n, p[u], f, e.call); d.children.push(m) } return i["part" + n] = { id: n, params: e, config: d, items: f } }, getConfig: function (e) { return o.getConfig(e, i) }, item: { switch: function (e, a) { var n = i["part" + e]; if (n) { var o = n.items["item" + a]; if (o) { var l = $("#" + t.itemIdPrefix + a).children(".p-accordion-body"); l.hasClass(s.none) ? (l.removeClass(s.none), o.show = !0) : (l.addClass(s.none), o.show = !1), r.callFn(window.ui, o.call.switch.fn, o.call.switch.params, o) } else console.log("Accordion error: ID:" + e + ", itemId:" + a + " is undefined!") } else console.log("Accordion error: ID:" + e + " is undefined!") } } } }, screen: new function () { var i = n.screen, s = {}, l = { name: "div", properties: { class: "p-screen" }, children: [{ name: "div", properties: { class: "p-screen-data" }, text: "" }, { name: "div", properties: { class: "p-screen-select" }, children: [] }] }, p = { name: "div", properties: { class: "p-screen-group" }, children: [{ name: "div", properties: { class: "p-screen-title" }, text: "" }, { name: "div", properties: { class: "p-screen-items" }, children: [] }] }, c = { name: "div", properties: { class: "p-screen-item" }, text: "" }, d = { name: "div", properties: { class: "p-screen-item" }, children: [{ name: "div", properties: { class: "p-screen-move" }, text: "<" }, { name: "div", properties: { class: "p-screen-text" }, text: "" }, { name: "div", properties: { class: "p-screen-delete" }, text: "X" }] }, f = { getConfig: function (e) { return o.getConfig(e, s) }, getData: function (e) { if (s["part" + e]) { var t = {}; return $("#" + i.idPrefix + e).children(".p-screen-data").children(".p-screen-group").each(function () { var e = $(this).attr("key"); t[e] = [], $(this).children(".p-screen-items").children(".p-screen-item").each(function () { var r = $(this).attr("key"), i = $(this).children(".p-screen-text").text(); t[e].push({ key: r, text: i }) }) }), t } } }, u = { check: function (a, n, o) { var l = s["part" + a]; if (l) { var p = l.params.show, c = $("#" + i.idPrefix + a), f = c.children(".p-screen-select").children("div[name='" + i.groupIdPrefix + n + "']"), u = f.children(".p-screen-items").children("div[name='" + i.itemIdPrefix + o + "']"); if (u.hasClass("p-screen-checked") ? u.removeClass("p-screen-checked") : u.addClass("p-screen-checked"), 0 != p) { var m = c.children(".p-screen-data"), v = m.children("div[name='" + i.groupIdPrefix + n + "']"); if (u.hasClass("p-screen-checked")) { if (0 == v.length) { var g = h(a, { key: n, title: f.children(".p-screen-title").text() }); m.append(t.buildModule(g)), v = m.children("div[name='" + i.groupIdPrefix + n + "']") } var y = function (t, a, n) { var o = n.key, s = n.text, l = r.deepCopy(d); return l.properties.name = i.itemIdPrefix + o, l.properties.key = o, l.children[0].properties.onclick = e + ".parts.screen.item.move('" + t + "','" + a + "','" + o + "')", l.children[1].text = s, l.children[2].properties.onclick = e + ".parts.screen.item.delete('" + t + "','" + a + "','" + o + "')", l }(a, n, { key: o, text: u.text() }); v.children(".p-screen-items").append(t.buildModule(y)) } else { var x = v.children(".p-screen-items"); 1 == x.children(".p-screen-item").length ? v.remove() : x.children("div[name='" + i.itemIdPrefix + o + "']").remove() } } } }, delete: function (e, t, r) { var a = $("#" + i.idPrefix + e), n = a.children(".p-screen-data").children("div[name='" + i.groupIdPrefix + t + "']"), o = n.children(".p-screen-items"); 1 == o.children(".p-screen-item").length ? n.remove() : o.children("div[name='" + i.itemIdPrefix + r + "']").remove(), a.children(".p-screen-select").children("div[name='" + i.groupIdPrefix + t + "']").children(".p-screen-items").children("div[name='" + i.itemIdPrefix + r + "']").removeClass("p-screen-checked") }, move: function (e, t, r) { var a = $("#" + i.idPrefix + e).children(".p-screen-data").children("div[name='" + i.groupIdPrefix + t + "']").children(".p-screen-items").children("div[name='" + i.itemIdPrefix + r + "']"), n = a.prev(); 1 == n.length && a.insertBefore(n) } }; function m(t, a, n) { var o = n.key, s = n.text, l = r.deepCopy(c); return l.properties.onclick = e + ".parts.screen.item.check('" + t + "','" + a + "','" + o + "')", l.properties.name = i.itemIdPrefix + o, l.properties.key = o, l.text = s, l } function h(e, t) { var a = t.key, n = t.title, o = t.items ? t.items : [], s = r.deepCopy(p); s.properties.name = i.groupIdPrefix + a, s.properties.key = a; var l = s.children[0]; n && (l.text = n); for (var c = s.children[1], d = 0; d < o.length; d++) { var f = m(e, a, o[d]); c.children.push(f) } return s } return { build: function (e) { var t = e.id, n = e.style, o = e.groups ? e.groups : []; r.isEmpty(t) && (e.id = t = r.getUuid(a)); var p = r.deepCopy(l); p.properties.id = i.idPrefix + t; var c = p.children[1]; n && (c.properties.style = n); for (var d = 0; d < o.length; d++) { var f = h(t, o[d]); c.children.push(f) } return s["part" + t] = { id: t, params: e, config: p } }, getConfig: f.getConfig, getData: f.getData, item: { check: u.check, delete: u.delete, move: u.move } } }, rotate: new function () { var t = n.rotate, i = {}, l = { name: "div", properties: { class: "p-rotate" }, children: [{ name: "div", properties: { class: "p-rotate-left" }, text: "<" }, { name: "div", properties: { class: "p-rotate-right" }, text: ">" }, { name: "div", properties: { class: "p-rotate-select" }, children: [] }, { name: "div", properties: { class: "p-rotate-items" }, children: [] }] }, p = { name: "div", properties: { class: "p-rotate-select-item" }, text: "" }, c = { name: "div", properties: { class: "p-rotate-item" }, children: [{ name: "div", properties: { class: "p-rotate-text" }, text: "" }, { name: "div", properties: { class: "p-rotate-img" }, children: [{ name: "img", properties: {} }] }] }, d = { getConfig: function (e) { return o.getConfig(e, i) }, check: function (e, r) { var a = i["part" + e]; if (a) { var n, o = $("#" + t.idPrefix + e).children(".p-rotate-items"); if ("L" == r) { var l = a.params.items.length - 1; 0 == (n = o.children(".p-rotate-item").not(".p-none").prev(".p-rotate-item")).length && (n = o.children(".p-rotate-item").eq(l)) } else "R" == r ? 0 == (n = o.children(".p-rotate-item").not(".p-none").next(".p-rotate-item")).length && (n = o.children(".p-rotate-item").eq(0)) : n = o.children(".p-rotate-item").eq(r); n.siblings().addClass(s.none), n.removeClass(s.none) } } }; function f(t, i, a, n, s, l, p) { var d = l.img, f = l.text; o.initItemCall(l, p, ["click"]); var u = r.deepCopy(c); if (d) { var m = u.children[1]; m.properties.onclick = e + ".parts.rotate.item.click('" + t + "','" + i + "')", m.children[0].properties.src = d, m.children[0].properties.width = a, m.children[0].properties.height = n } if (f) { var h = Math.ceil(1.1 * s), v = u.children[0]; v.properties.style = "width:" + (a - 2 * h) + "px;height:" + .9 * n + "px;margin-left:" + h + "px;", v.text = f } return u } return { build: function (n) { var c = n.id, d = parseInt(n.width), u = parseInt(n.height), m = n.show ? n.show : 1, h = n.items ? n.items : []; r.isEmpty(c) && (n.id = c = r.getUuid(a)), o.initCall(n, ["click"]), (isNaN(d) || d < 200) && (d = 200), (isNaN(u) || u < 100) && (u = 100); var v = r.deepCopy(l); v.properties.id = t.idPrefix + c, v.properties.style = "width:" + d + "px;height:" + u + "px"; var g = d / 15 > 35 ? Math.ceil(d / 15) : 35, y = v.children[0]; y.properties.onclick = e + ".parts.rotate.check('" + c + "','L')", y.properties.style = "width:" + g + "px;height:" + u + "px;line-height:" + u + "px;"; var x = v.children[1]; x.properties.onclick = e + ".parts.rotate.check('" + c + "','R')", x.properties.style = "width:" + g + "px;height:" + u + "px;line-height:" + u + "px;margin-left:" + (d - g) + "px;"; var b = v.children[2]; b.properties.style = "margin-left:" + Math.ceil(1.5 * g) + "px;margin-top:" + .9 * u + "px"; for (var k = v.children[3], w = 0; w < h.length; w++) { var P = h[w], C = r.deepCopy(p); C.properties.onclick = e + ".parts.rotate.check('" + c + "','" + w + "')", C.text = w + 1, b.children.push(C); var I = f(c, w, d, u, g, P, n.call); m != w + 1 && (I.properties.class += " " + s.none), k.children.push(I) } return i["part" + c] = { id: c, params: n, config: v } }, getConfig: d.getConfig, check: d.check, item: { click: function (e, t) { var a = i["part" + e]; if (a) { var n = a.params.items[t]; n && r.callFn(window.ui, n.call.click.fn, n.call.click.params, n) } } } } }, doc: new function () { n.doc; var e = {}, t = { name: "div", properties: { class: "p-doc" }, children: [{ name: "div", properties: { class: "p-doc-tool" }, children: [{ name: "span", text: "添加文本" }, { name: "span", text: "添加图片" }, { name: "span", text: "添加代码" }] }, { name: "div", properties: { class: "p-doc-content", contenteditable: "true" }, children: [{ name: "p", text: "请输入内容......" }] }] }, i = { text: { name: "div", properties: { class: "p-doc-content-text" }, text: "" }, img: { name: "img", properties: { class: "p-doc-content-img" }, text: "" }, code: { name: "div", properties: { class: "p-doc-content-code" }, text: "" }, none: { name: "div", properties: {}, text: "请输入内容......" } }; function s(e, t) { t || (t = []), r.is.Array(t) || t.push(t); for (var n = [], o = 0; o < t.length; o++) { var s = t[o], l = s.id, p = s.type, c = s.class, d = s.content; r.isEmpty(l) && (s.id = l = r.getUuid(a)); var f = r.deepCopy(i.none); "TEXT" == p ? (f = r.deepCopy(i.text), c && (f.properties.class = c), f.text = d) : "IMG" == p ? (f = r.deepCopy(i.img), c && (f.properties.class = c), s.width && (f.properties.width = s.width), s.height && (f.properties.height = s.height), f.src = d) : "CODE" == p && (f = r.deepCopy(i.code), c && (f.properties.class = c), f.text = d), f.properties.id = l, n.push(f) } return n } return { build: function (i) { var n = i.id, o = (i.tool, i.list); r.isEmpty(n) && (i.id = n = r.getUuid(a)); var l = r.deepCopy(t); return l.children[1].children = s(0, o), e["part" + n] = { id: n, params: i, config: l } }, getConfig: function (t) { return o.getConfig(t, e) } } } } }, function (e, t, r, i, a) { var n, o = a.module, s = {}, l = { ids: { form: "01", page: "02", tool: "03", list: "04", search: "05", table: "06", content: "07", tree: "08", windows: "09" }, ajax: function (e, t, a) { if (e.type || (e.type = "POST"), e.params || (e.params = {}), t) { var n = a.paramsName; e.params[n.currPage] = t.curr, e.params[n.pageShowSize] = t.showSize } console.log("Module load url: ", e.url, "; data:", e.params), $.ajax({ url: e.url, type: e.type, data: e.params, success: function (n) { var o = a.resultPath; if (1 == r.getByPath(n, o.success)) { var s = r.getByPath(n, o.msg), l = r.getByPath(n, t ? o.listData : o.data); if (s && alert(s), t && null != t) { var p = r.getByPath(n, o.currPage), c = r.getByPath(n, o.maxPage), d = r.getByPath(n, o.maxCount); p && (t.curr = parseInt(p)), t.maxPage = r.isEmpty(c) ? -1 : c, r.isEmpty(c) && !r.isEmpty(d) && (t.maxCount = d), i.page.flush(t.id) } var f = e.dataFormat; if (f && "function" == typeof f) { var u = dataFormat(l); u && (l = u) } e.success && r.callFn(e, "success", l, e.bind) } else { var m = r.getByPath(n, o.errMsg); m && alert(m) } } }) }, tool: { replace: function (e, t) { return r.replace(e, t, "@{(.*?)}") }, getModule: function (e, t) { var r = e.moduleId, i = e.module; return i || (i = t["module" + r]), i }, loadFormOptions: function (e, t) { var a = []; if (e.form && a.push(e.form), e.search && a.push(e.search.form), e.windows) { var n = e.windows; for (var o in n) if (n.hasOwnProperty(o)) { var p = n[o]; a.push(p.form) } } for (var c = 0; c < a.length; c++)for (var d = a[c], f = d.id, u = d.elements, m = 0; m < u.length; m++) { var h = u[m]; if (h.load) { var v = h.load, g = v.ref, y = 1 == v.refresh, x = v.text, b = v.value ? v.value : x, k = function (e) { g && (s[g].data = e); for (var t = h.children = [], r = 0; r < e.length; r++) { var a = e[r]; t.push({ text: a[x], value: a[b] }) } i.form.element.setDom(f, h.key, h) }, w = { id: r.getUuid("L"), success: k, type: v.type ? v.type : "GET", url: v.url, params: v.params }; if (g) { var P = s[g]; P || (P = s[g] = { url: v.url, params: v.params }), P.data && 1 != y ? k(P.data) : (w.url || (w.url = P.url, w.params = P.params, w.type = P.type ? P.type : "GET"), l.ajax(w, void 0, t)) } else l.ajax(w, void 0, t) } } } }, fns: { form: function (e, t) { var a, n = l.ids.form, o = l.tool.getModule; function s(r) { var a = o(r, e); if (a && a.params.form) { var n = a.params; a.params.form.load.success = function (e) { i.form.setData(n.form.id, e) }, 1 == r.first && l.tool.loadFormOptions(n, t), l.call.query(a, "form", t) } } return a = { build: function (e, t) { var o = t.id = e + "_" + n, s = t.form, l = t.buttons, p = []; if (s) { s.id = o; var c = i.form.build(s); t.form = c.params, p.push(c.config) } if (l) { r.is.Array(l) && (l = { buttons: l }), l.id = o; for (var d = 0; d < l.buttons.length; d++) { var f = l.buttons[d]; f.call = {}, f.call.click = {}, f.call.click.fn = a.click, f.call.click.params = { moduleId: e } } var u = i.buttons.build(l); t.buttons = u.params, p.push(u.config) } return { id: e, params: t, config: p } }, loadData: s, initData: function (t) { var i = o(t, e); if (i && i.params.form) { var a = t.data, n = i.params; if (n.form) { var s = n.form.id; r.is.Array(n.form) && (s = moduleId), a ? ui.parts.form.setData(s, a) : ui.parts.form.initData(n.form.id) } } }, getData: function (t) { var r = o(t, e); if (r && r.params.form) { var i = r.params; if (i.form) return ui.parts.form.getData(i.form.id) } }, removeData: function (t) { var r = o(t, e); if (r && r.params.form) { var i = r.params; i.form && ui.parts.form.removeData(i.form.id) } }, help: function (t) { var r = o(t, e); if (r && r.params.form) { var a = r.params; i.form.showHelp(a.form.id, "auto") } }, click: function (t) { var i = this.fn; if (i) { var n = o(t, e); if (n) { var s = { button: this, module: n.params }; r.callFn(a.call, i, void 0, s) } } }, call: { linkTo: function () { var e = this.button, t = this.module, r = i.form.getData(t.form.id); l.call.linkTo(e, r) }, save: function () { var e = this.button, r = this.module; if (e.url) { var a = i.form.getData(r.form.id); e.success = function () { s({ moduleId: r.id }) }, l.call.save(e, a, t) } } } } }, page: function (e, t, r) { var a, n = l.ids.page; l.tool.getModule; return a = { build: function (e, t) { return t.id = e + "_" + n, t.moduleId = e, t.call = { click: { fn: a.check, params: { moduleId: e } } }, i.page.build(t) }, check: function (e) { t({ moduleId: e.moduleId }) } } }, tool: function (e, t, a) { var n, o = l.ids.tool, s = l.tool.getModule; var p = { openWindow: function () { var e = this.button; l.call.openWindow(e) }, edit: function () { this.button; var e = this.module; e && i.list.edit(e.list.id) }, isCheckAll: !1, checkAll: function () { this.button; var e = this.module; e.list ? (i.list.edit(e.list.id, !0), i.list.checkAll(e.list.id)) : e.table && (i.table.row.check(e.table.id, !p.isCheckAll), p.isCheckAll = !p.isCheckAll) }, dels: function () { var e = this.button, r = this.module; if (r) { var i = []; if (r.list) for (var n = ui.parts.list.removeChecked(r.list.id), o = 0; o < n.length; o++) { var s = n[o]; s.data && i.push(s.data) } else r.table && (i = ui.parts.table.removeChecked(r.table.id)); e.success = function () { t({ moduleId: r.id }) }, l.call.dels(e, i, a) } } }; return n = { build: function (e, t) { r.is.Array(t) && (t = { id: e, buttons: t }), t.moduleId = e, t.align = "left", t.id = e + "_" + o; for (var a = t.buttons, s = 0; s < a.length; s++) { var l = a[s]; l.moduleId = e, l.call = {}, l.call.click = {}, l.call.click.fn = n.click, l.call.click.params = { moduleId: e } } return i.buttons.build(t) }, click: function (t) { var i = this.fn; if (i) { var a = s(t, e); if (a) { var o = { button: this, module: a.params }; r.callFn(n.call, i, void 0, o) } } }, call: p } }, list: function (e, t) { var a, n = l.ids.list, o = l.tool.getModule; return a = { build: function (e, t) { t.id = e + "_" + n; var r = t.items = [], o = t.contents ? t.contents : []; t.call = { click: { fn: a.click, params: { moduleId: e } } }; for (var s = 0; s < o.length; s++) { var l = o[s]; l.operations && (l.operations.call = { click: { fn: a.operation, params: { moduleId: e } } }); var p = i.content.build(l); r.push({ content: p.config }) } var c = i.list.build(t); return delete t.items, c }, loadData: function (r) { var n = o(r, e), s = n.params; if (s.list && s.list.load) { var p = n.id, c = n.params.list.load; c.success = function (e) { i.list.empty(p); for (var t = 0; t < e.length; t++) { var r = e[t], n = l.tool.replace(c.temp, r); n.data = r, n.operations && (n.operations.call = { click: { fn: a.operation, params: { moduleId: p } } }); var o = i.content.build(n); o && i.list.item.add(s.list.id, { data: r, content: [o.config] }) } }, 1 == r.first && l.tool.loadFormOptions(s, t), l.call.query(n, "list", t) } }, click: function (t) { var i = o(t, e); if (i) { var n = i.params.list.fn, s = { content: this, module: i.params }; n && r.callFn(a.call, n, void 0, s) } }, operation: function (t) { var i = this.operation.fn; if (i) { var n = o(t, e); if (n) { var s = { operation: this.operation, content: this.content, module: n.params }; r.callFn(a.call, i, void 0, s) } } event.stopPropagation() }, call: { openWindow: function () { var e = this.operation; e.moduleId = this.module.id, l.call.openWindow(e, this.content.data) }, del: function () { var e = this.operation, r = this.module; e.success = function () { a.loadData({ moduleId: r.id }) }, l.call.del(e, this.content.data, t) }, linkTo: function () { var e = this.operation, t = this.content.data; l.call.linkTo(e, t) } } } }, search: function (e, t, a) { var n, o = l.ids.search, s = l.tool.getModule; return n = { build: function (e, t) { var a = t.id = e + "_" + o, s = 0 != t.show, l = t.form, p = t.buttons, c = []; if (l) { l.id = a; var d = i.form.build(l); t.form = d.params, c.push(d.config) } if (p) { r.is.Array(p) && (p = { buttons: p }), p.id = a; for (var f = 0; f < p.buttons.length; f++) { var u = p.buttons[f]; u.call = {}, u.call.click = {}, u.call.click.fn = n.click, u.call.click.params = { moduleId: e } } var m = i.buttons.build(p); t.buttons = m.params, c.push(m.config) } return { id: e, params: t, config: [i.accordions.build({ id: a, items: [{ show: s, title: "【显示/隐藏】查询条件", body: { style: "border:0px;", content: c } }] }).config] } }, setData: function (t) { var r = s(t, e); if (r && r.params.search) { var a = t.data; i.form.setData(r.params.search.form.id, a) } }, click: function (t) { var i = this.fn; if (i) { var a = s(t, e); if (a) { var o = { button: this, module: a.params }; r.callFn(n.call, i, void 0, o) } } }, call: { query: function () { this.button; var e = this.module; t({ moduleId: e.id }) } } } }, table: function (e, t) { var a, n = l.ids.table, o = l.tool.getModule; return a = { build: function (e, t) { t.moduleId = e; var r = t.id = e + "_" + n, o = t.screen, s = t.operations; if (s) for (var l in s) if (s.hasOwnProperty(l)) { var p = s[l]; p.moduleId = e, p.params = { moduleId: e, fn: p.fn }, p.fn = a.operation } var c = []; if (o) { var d = function (e, t) { var r = []; for (var a in t) if (t.hasOwnProperty(a)) { var n = t[a]; r.push({ key: a, text: n }) } var o = { id: e, groups: [{ key: "colEdit", title: "自定义列", items: r }] }, s = i.screen.build(o), l = { id: e, items: [{ title: "表格自定义列", body: { style: "border:0px", content: s.config }, call: { switch: function () { if (0 == this.show) { var t = i.screen.getData(e); if (t.colEdit) { for (var r = t.colEdit, a = {}, n = 0; n < r.length; n++) { var o = r[n]; a[o.key] = o.text } var s = i.table.getConfig(e); i.table.col.edit(e, a, s.$data) } } } } }] }; return i.accordions.build(l) }(r, o); c.push(d.config) } var f = i.table.build(t); return c.push(f.config), { id: e, params: t, config: c } }, loadData: function (r) { var a = o(r, e), n = a.params; n.table && n.table.load && (a.params.table.load.success = function (e) { n.table.$data = e, i.table.row.setData(n.table.id, e) }, 1 == r.first && l.tool.loadFormOptions(n, t), l.call.query(a, "table", t)) }, operation: function (t) { var i = t.fn; if (i) { var n = o(t, e); if (n) { var s = { operation: this.operation, data: this.data, module: n.params }; r.callFn(a.call, i, void 0, s) } } }, call: { openWindow: function () { var e = this.operation, t = this.data; this.module; l.call.openWindow(e, t) }, del: function () { var e = this.operation, r = this.module; e.success = function () { a.loadData({ moduleId: r.id }) }, l.call.del(e, this.data, t) }, linkTo: function () { var e = this.module, t = this.operation, r = i.table.row.getData(e.table.id, t.index); l.call.linkTo(t, r) } } } }, content: function (e, t) { var a, n = l.ids.content, o = l.tool.getModule; return a = { build: function (e, t) { if (t) return t.id = e + "_" + n, t.operations && (t.operations.moduleId = e, t.operations.call = { click: { fn: a.operation, params: { moduleId: e } } }), i.content.build(t) }, loadData: function (r) { var n = o(r, e); if (n && n.params.load) { var s = n.id, p = n.params.load; p && p.url && p.temp && (p.success || (p.success = function (e) { var r = l.tool.replace(p.temp, e); r.operations && (r.operations.call = { click: { fn: a.operation, params: { moduleId: s } } }), r.data = e; var n = i.content.build(r), o = ui.build.buildModule([n.config]); $("#" + t.idPrefix + s).find("div[part='content']").html(o) }), l.ajax(p, n.params.page, t)) } }, operation: function (t) { var i = this.operation.fn; if (i) { var n = o(t, e); if (n) { var s = { operation: this.operation, content: this.content, module: n.params }; r.callFn(a.call, i, void 0, s) } } }, call: { openWindow: function () { var e = this.operation; e.moduleId = this.module.id, l.call.openWindow(e, this.content.data) }, linkTo: function () { var e = this.operation, t = this.content.data; l.call.linkTo(e, t) } } } }, tree: function (e, t) { l.ids.tree; var a = l.tool.getModule; return { build: function (e, t) { return t.id || (t.id = e), i.tree.build(t) }, loadData: function (i) { var n = a(i, e), o = n.params; if (o.tree && o.tree.load) { var s = n.params.tree.load, p = s.temp, c = (s.format, function (e, t) { if (t.items && r.is.Array(t.items)) { for (var i = t.items, a = [], n = 0; n < i.length; n++) { var o = l.tool.replace(e, i[n]); c(e, o), a.push(o) } t.items = a } else t.items = void 0 }); s.success = function (e) { for (var t = 0; t < e.length; t++) { var r = e[t], i = l.tool.replace(p, r); c(p, i) } ui.parts.tree.item.setItems([]) }, l.call.query(n, "tree", t) } } } }, windows: function (e, t, a) { var n, o = l.ids.windows, s = l.tool.getModule; function p(e, t) { var r = t.id = d(e, t.id); t.form ? t.type = "form" : t.screen ? t.type = "screen" : t.table ? t.type = "table" : t.type = void 0; var a = t.type; if (null != a) { var n = []; return n.push(ui.build.tags.brConfig[0]), (0, c[a])(r, t, n), n.push(ui.build.tags.brConfig[0]), t.body = n, i.window.build(t) } console.log("window's type is undefined") } var c = { form: function (e, t, a) { var o = t.id, s = t.form, l = t.buttons; if (s) { r.is.Array(s) ? s = { id: o, elements: s } : s.id = o; var p = i.form.build(s); t.form = p.params, a.push(p.config) } if (l) { r.is.Array(l) ? l = { id: o, buttons: l } : l.id = o; for (var c = 0; c < l.buttons.length; c++) { var d = l.buttons[c]; d.call = {}, d.call.click = {}, d.call.click.fn = n.click, d.call.click.params = { moduleId: e, window: t } } var f = i.buttons.build(l); t.buttons = f.params, a.push(f.config) } }, table: function (e, t, r) { t.id, t.search, t.tool, t.table, t.page }, screen: function (e, t, a) { var o = t.id, s = t.screen, l = t.buttons; if (s) { r.is.Array(s) ? s = { id: o, groups: s } : s.id = o; var p = i.screen.build(s); t.screen = p.params, a.push(p.config) } if (l) { r.is.Array(l) ? l = { id: o, buttons: l } : l.id = o; for (var c = 0; c < l.buttons.length; c++) { var d = l.buttons[c]; d.call = {}, d.call.click = {}, d.call.click.fn = n.click, d.call.click.params = { moduleId: e, window: t } } var f = i.buttons.build(l); t.buttons = f.params, a.push(f.config) } } }; function d(e, t) { return e + "_" + o + "_" + t } return n = { build: function (e, t) { for (var r = t || [], i = [], a = [], n = 0; n < r.length; n++) { var o = r[n]; o.id || (o.id = "w" + n); var s = p(e, o); i.push(s.params), a.push(s.config) } return { id: e, params: t, config: a } }, init: function (e) { var t = d(e.moduleId, e.windowId), r = ui.parts.window.getConfig(t); if (r) { var i = r.form.id, a = e.data; a ? ui.parts.form.setData(i, a) : ui.parts.form.initData(i) } }, getWindowId: d, open: function (e, t) { ui.parts.window.open(d(e, t)) }, close: function (e, t) { ui.parts.window.close(d(e, t)) }, click: function (t) { var i = this.fn; if (i) { var a = s(t, e); if (a) { var o = { button: this, window: t.window, module: a.params }; r.callFn(n.call, i, void 0, o) } } }, call: { save: function () { var e = this.button, r = this.window, i = this.module; if (e.url) { var n = ui.parts.form.getData(r.form.id); e.success = function () { t({ moduleId: i.id }) }, ui.parts.window.close(r.id), l.call.save(e, n, a) } } } } } }, call: { openWindow: function (e, t) { var r = e, i = r.to; i && (0 != r.init && t && n.window.init({ moduleId: r.moduleId, windowId: i, data: t }), n.window.open(r.moduleId, i)) }, save: function (e, t, r) { var i = e; if (i.url) { var a = i.params, n = t || {}; if (a) for (var o in a) if (a.hasOwnProperty(o)) { var s = a[o]; n[o] = s } l.ajax({ url: i.url, type: i.type, params: n, success: i.success }, void 0, r) } }, del: function (e, t, r) { var i = e; if (i.url && confirm("确认删除吗？")) { var a = i.paramKeys, n = i.urlParams ? i.urlParams : {}, o = t; if (a) for (var s = 0; s < a.length; s++) { var p = a[s]; n[p] = o[p] } else for (var c in o) o.hasOwnProperty(c) && (n[c] || (n[c] = o[c])); l.ajax({ url: i.url, type: i.type, params: n, success: i.success }, void 0, r) } }, dels: function (e, t, i) { var a = e; if (a.url && confirm("确认删除吗？")) { var n = a.paramKeys, o = a.urlParams ? a.submitParams : {}, s = t || []; if (r.is.String(n)) o[n] = h; else if (r.is.Array(n)) for (var p = 0; p < n.length; p++) { var c = n[p]; r.is.String(c) && (c = { key: c }); var d = c.key; if (!r.isEmpty(d)) for (var f = c.name ? c.name : d + "s", u = null == c.split ? "," : c.split, m = (c = o[f], 0); m < s.length; m++) { var h = s[m]; for (var v in h) if (h.hasOwnProperty(v) && v == d) { var g = h[v]; 0 == u ? (c || (c = o[f] = []), c.push(g)) : c = c ? o[f] += u + g : o[f] = g } } } l.ajax({ url: a.url, type: a.type, params: o, success: a.success }, void 0, i) } }, query: function (e, t, r) { if (e) { var a, n = e.params, o = n[t].load, s = o.params ? o.params : {}; if (n.search && (a = i.form.getData(n.search.form.id)), a) for (var p in a) if (a.hasOwnProperty(p)) { var c = a[p]; s[p] = c } l.ajax({ url: o.url, type: o.type, temp: o.temp, params: s, success: o.success }, n.page, r) } else console.log("Module error: load params is undefined.") }, linkTo: function (e, t) { var i = e; if (i.url) { var a = i.urlParams, n = ""; if (a) { var o = t || {}; r.is.Array(a) || (a = [a]); for (var s = 0; s < a.length; s++) { var l = a[s]; r.is.String(l) ? n += "&" + l + "=" + o[l] : r.is.Object(l) ? n += "&" + l.name + "=" + o[l.key] : console.log("This linkTo's 'params' param must 'String' or 'Object{name,key}'.") } -1 == i.url.indexOf("?") && (n = "?" + n.substring(1, n.length)) } window.location.href = i.url + n } } } }; return n = { $dict: s, tree: new function () { var e = o.form, t = {}, i = { name: "div", properties: {}, children: [{ name: "div", properties: { part: "tree" } }] }, a = new l.fns.tree(t, e); return { build: function (e) { var n = e.id, o = e.tree, s = r.deepCopy(i); if (o) { var l = a.build(n, o); s.children[0] = l } return t["module" + n] = { id: n, params: e, config: s } }, tree: a, setting: e } }, table: new function () { var e = o.table, i = {}, a = { name: "div", properties: {}, children: [{ name: "div", properties: { part: "search" }, children: [] }, { name: "div", properties: { part: "tool" }, children: [] }, { name: "div", properties: { part: "table" }, children: [] }, { name: "div", properties: { part: "page" }, children: [] }, { name: "div", properties: { part: "windows" }, children: [] }] }, n = { getConfig: function (e) { var t = i["module" + e]; if (t) return t.params } }, s = new l.fns.table(i, e), p = new l.fns.search(i, s.loadData, e), c = new l.fns.tool(i, s.loadData, e), d = new l.fns.page(i, s.loadData, e), f = new l.fns.windows(i, s.loadData, e); return { build: function (n) { var o = n.id, l = n.search, u = n.tool, m = n.table, h = n.page, v = n.windows, g = r.deepCopy(a); if (g.properties.id = e.idPrefix + o, l) { var y = p.build(o, l); y && (g.children[0].properties.style = "text-align: center;", n.search = y.params, g.children[0].children = y.config) } if (u) { var x = c.build(o, u); x && (n.tool = x.params, g.children[1].children = [x.config]) } if (m) { var b = s.build(o, m); if (b) { var k = b.config; k.push(t.tags.brConfig[0]), n.table = b.params, g.children[2].children = k } } if (h) { var w = d.build(o, h); if (w) { n.page = w.params; var P = [w.config]; P.push(t.tags.brConfig[0]), g.children[3].children = P } } if (v) { var C = f.build(o, v); C && (n.windows = C.params, g.children[4].children = C.config) } return i["module" + o] = { id: o, params: n, config: g } }, getConfig: n.getConfig, search: p, tool: c, table: s, page: d, windows: f, setting: e } }, content: new function () { var e = o.content, i = {}, a = { name: "div", properties: {}, children: [{ name: "div", properties: { part: "content" } }, { name: "div", properties: { part: "page" } }, { name: "div", properties: { part: "windows" } }] }, n = { getConfig: function (e) { var t = i["module" + e]; if (t) return t.params } }, s = new l.fns.content(i, e), p = new l.fns.page(i, s.loadData, e), c = new l.fns.windows(i, s.loadData, e); return { build: function (n) { var o = n.id, l = n.content, d = n.page, f = n.windows, u = r.deepCopy(a); u.properties.id = e.idPrefix + o; var m = s.build(o, l); if (m && (n.content = m.params, u.children[0].children = [m.config]), d) { var h = p.build(o, d); if (h) { n.page = h.params; var v = [h.config]; v.push(t.tags.brConfig[0]), u.children[1].children = v } } if (f) { var g = c.build(o, f); g && (n.windows = g.params, u.children[2].children = g.config) } return i["module" + o] = { id: o, params: n, config: u } }, getConfig: n.getConfig, content: s, page: p, window: c, setting: e } }, list: new function () { var e = o.list, i = {}, a = { name: "div", properties: {}, children: [{ name: "div", properties: { part: "search" } }, { name: "div", properties: { part: "tool" } }, { name: "div", properties: { part: "list" } }, { name: "div", properties: { part: "page" } }, { name: "div", properties: { part: "windows" } }] }, n = { getConfig: function (e) { var t = contentModuleObj["module" + e]; if (t) return t.params } }, s = new l.fns.list(i, e), p = new l.fns.search(i, s.loadData, e), c = new l.fns.tool(i, s.loadData, e), d = new l.fns.page(i, s.loadData, e), f = new l.fns.windows(i, s.loadData, e); return { build: function (n) { var o = n.id, l = n.list, u = n.page, m = n.search, h = n.tool, v = n.windows, g = r.deepCopy(a); if (g.properties.id = e.idPrefix + o, m) { var y = p.build(o, m); y && (g.children[0].properties.style = "text-align: center;", n.search = y.params, g.children[0].children = y.config) } if (h) { var x = c.build(o, h); x && (n.tool = x.params, g.children[1].children = [x.config]) } if (l) { var b = s.build(o, l); b && (n.list = b.params, g.children[2].children = [b.config]) } if (u) { var k = d.build(o, u); if (k) { n.page = k.params; var w = [k.config]; w.push(t.tags.brConfig[0]), g.children[3].children = w } } if (v) { var P = f.build(o, v); P && (n.windows = P.params, g.children[4].children = P.config) } return i["module" + o] = { id: o, params: n, config: g } }, getConfig: n.getConfig, search: p, list: s, page: d, setting: e } }, form: new function () { var e = o.form, t = {}, i = { name: "div", properties: {}, children: [] }, a = { getConfig: function (e) { var t = contentModuleObj["module" + e]; if (t) return t.params } }, n = new l.fns.form(t, e); return { build: function (a) { var o = a.id, s = a.display ? a.display : "block", l = (a.form, a.buttons, r.deepCopy(i)); l.properties.id = e.idPrefix + o; var p = n.build(o, a); return p && (l.properties.style = "display:" + s, l.children = p.config), t["module" + o] = { id: o, params: p.params, config: l } }, getConfig: a.getConfig, form: n, setting: e } }, window: new function () { var e = o.window, t = {}, r = new l.fns.windows(t, function () { }, e); return { build: function (e) { var i = e.id, a = e.windows ? e.windows : [], n = r.build(i, a); return t["module" + i] = { id: i, params: n.params, config: n.config } }, init: r.init, getWindowId: r.getWindowId, open: r.open, close: r.close, setting: e } } } }, function (e, t, r, i, a) { function n(e) { var t = e.id, r = e.style, i = e.properties, a = e.children, n = { name: "div", properties: {}, children: [] }; if (t && (n.properties.id = t), r && (n.properties.style = r), i) for (var o in i) if (i.hasOwnProperty(o)) { var s = i[o]; n.properties[o] = s } return n.children = a, n } return { build: function (a) { t.is.Array(a) && (a = { isBody: !0, children: a }); var o = a.id, s = 1 == a.isBody, l = a.init, p = a.before, c = a.children; p && p(); for (var d, f = [], u = 0; u < c.length; u++) { var m = c[u]; m.config || (m = { config: m }); var h = m.domId, v = m.type, g = m.config; if (v) { var y = v.split("."); if (2 == y.length) { var x = y[0], b = y[1], k = ("part" == x ? r[b].build(g) : i[b].build(g)).config; if (t.is.Array(k) || (k = [k]), h) { var w = e.buildModule(k); $("#" + h).html(w) } else m.children = k, f.push(n(m)) } else 1 == y.length && (w = "", "html" == v ? w = g : "config" == v && (t.is.Array(g) || (g = [g]), w = e.buildModule(g)), h ? $("#" + h).html(w) : f.push({ name: "div", properties: {}, text: w })) } } 1 == s ? (d = e.buildModule(f), $(document.body).html(d)) : o && (document.getElementById(o) ? (d = e.buildModule(f), $("#" + o).html(d)) : (a.children = f, d = e.buildModule(n(a)), $(document.body).append(d))); l && l() }, params: t.getQueryString() } }, 0, 0, function () { var e = { paramsName: { currPage: "page", pageShowSize: "pageSize" }, resultPath: { success: "success", currPage: "data.page", maxPage: "data.maxPage", maxCount: "data.maxCount", data: "data", listData: "data.data", msg: "errMsg", errMsg: "errMsg" } }; return { common: e, part: { window: { idPrefix: "p_window_", bgIdPrefix: "p_window_bg", bodyIdPrefix: "p_window_body_" }, form: { idPrefix: "p_forms_", elementIdPrefix: "p_form_", elementNamePrefix: "p_element_", helpMsgName: "p_form_help_msg", errorMsgName: "p_form_error_msg", fileNameSuffix: "File", fileReturnDataPath: "data", filePathNameSuffix: "Text", fileBrowseButtonName: "浏览", fileUploadButtonName: "上传" }, grid: { idPrefix: "p_grid_" }, drawBoard: { toolIdPrefix: "p_draw_", drawIdPrefix: "p_draw_shapes_", shapeIdPrefix: "p_draw_shape_", connectIdPrefix: "p_draw_connect_", connectLineIdPrefix: "p_draw_connect_line_", stratGap: 6, endGap: 6, allowNum: 15, connectPointText: ">" }, svg: { idPrefix: "p_svg_", elementNamePrefix: "p_svg_element_" }, buttons: { idPrefix: "p_button_" }, lineMap: { idPrefix: "p_lineMap_", lineIdPrefix: "p_lineMap_line_" }, custom: { idPrefix: "p_custom_" }, table: { idPrefix: "p_table_", checkIdPrefix: "p_tr_check_", checkAllIdPrefix: "p_tr_checkAll_", colNamePrefix: "p_table_key_", rowNamePrefix: "p_table_row_", defaultRowCount: 15, defaultHeaderAlign: "left", defaultBodyAlign: "left" }, tabs: { idPrefix: "p_tabs_", tabNamePrefix: "p_tab_" }, page: { idPrefix: "p_page_", lastText: " < ", nextText: " > ", firstlyText: "首页", finallyText: "末页", toText: "跳转到" }, nav: { idPrefix: "p_nav_", listIdPrefix: "p_nav_list_", groupIdPrefix: "p_nav_group_", nodeIdPrefix: "p_nav_node_" }, content: { idPrefix: "p_content_", operationNamePrefix: "p_operation_" }, list: { idPrefix: "p_list_", itemNamePrefix: "p_list_item_" }, tree: { idPrefix: "p_tree_", itemNamePrefix: "p_tree_item_" }, accordion: { idPrefix: "p_accordions_", itemIdPrefix: "p_accordion_" }, screen: { idPrefix: "p_screen_", groupIdPrefix: "p_screen_group_", itemIdPrefix: "p_screen_item_" }, rotate: { idPrefix: "p_rotate_", itemIdPrefix: "p_rotate_item_" }, doc: { idPrefix: "p_doc_", itemIdPrefix: "p_doc_item_" } }, module: { info: { idPrefix: "m_form_" }, list: { idPrefix: "m_list_", currPage: 1, pageSize: 10, paramsName: { currPage: e.paramsName.currPage, pageShowSize: e.paramsName.pageShowSize }, resultPath: { success: e.resultPath.success, currPage: e.resultPath.currPage, maxPage: e.resultPath.maxPage, maxCount: e.resultPath.maxCount, data: e.resultPath.data, listData: e.resultPath.listData, msg: e.resultPath.msg, errMsg: e.resultPath.errMsg } }, content: { idPrefix: "m_content_", currPage: 1, pageSize: 10, paramsName: { currPage: e.paramsName.currPage, pageShowSize: e.paramsName.pageShowSize }, resultPath: { success: e.resultPath.success, currPage: e.resultPath.currPage, maxPage: e.resultPath.maxPage, maxCount: e.resultPath.maxCount, data: e.resultPath.data, listData: e.resultPath.listData, msg: e.resultPath.msg, errMsg: e.resultPath.errMsg } }, form: { idPrefix: "m_form_", currPage: 1, pageSize: 10, paramsName: { currPage: e.paramsName.currPage, pageShowSize: e.paramsName.pageShowSize }, resultPath: { success: e.resultPath.success, currPage: e.resultPath.currPage, maxPage: e.resultPath.maxPage, maxCount: e.resultPath.maxCount, data: e.resultPath.data, listData: e.resultPath.listData, msg: e.resultPath.msg, errMsg: e.resultPath.errMsg } }, window: { idPrefix: "m_windows_", currPage: 1, pageSize: 10, paramsName: { currPage: e.paramsName.currPage, pageShowSize: e.paramsName.pageShowSize }, resultPath: { success: e.resultPath.success, currPage: e.resultPath.currPage, maxPage: e.resultPath.maxPage, maxCount: e.resultPath.maxCount, data: e.resultPath.data, listData: e.resultPath.listData, msg: e.resultPath.msg, errMsg: e.resultPath.errMsg } }, table: { idPrefix: "m_table_", addWindowName: "add", updateWindowName: "update", currPage: 1, pageSize: 10, paramsName: { currPage: e.paramsName.currPage, pageShowSize: e.paramsName.pageShowSize }, resultPath: { success: e.resultPath.success, currPage: e.resultPath.currPage, maxPage: e.resultPath.maxPage, maxCount: e.resultPath.maxCount, data: e.resultPath.data, listData: e.resultPath.listData, msg: e.resultPath.msg, errMsg: e.resultPath.errMsg } } }, page: {} } });